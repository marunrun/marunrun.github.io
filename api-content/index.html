{"posts":[{"title":"k8så®‰è£…kafka  kafka-ui ","content":"k8så®‰è£…kafka å¹¶å¼€æ”¾å¤–éƒ¨è®¿é—® å‚è€ƒæ–‡æ¡£ï¼š kafka 19.1.3 Â· bitnami/bitnami (artifacthub.io) charts/values.yaml at main Â· bitnami/charts (github.com) æ·»åŠ  helm repo helm bitnami add bitnami https://charts.bitnami.com/bitnami å¦‚æœä½¿ç”¨PV è¯·æå‰é…ç½®å¥½storageclass ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ kubectl get storageclass å»ºè®®ä½¿ç”¨values.yamlè¿›è¡Œé…ç½® kafka é»˜è®¤é…ç½®å‚è€ƒï¼šcharts/values.yaml at main Â· bitnami/charts (github.com) å¯¹åº”çš„zookeeperé»˜è®¤é…ç½® charts/bitnami/zookeeper at main Â· bitnami/charts (github.com) å¦‚æœä½¿ç”¨PV éœ€è¦é…ç½®æƒé™,ä¸ç„¶ä¼šå‡ºç°æ²¡æœ‰æƒé™çš„æƒ…å†µ volumePermissions: enabled: true zookeeper: volumePermissions: enabled: true å¦‚éœ€ä½¿ç”¨å¤–ç½‘è®¿é—®è¯·å‚è€ƒæ–‡æ¡£charts/bitnami/kafka at main Â· bitnami/charts (github.com)æ·»åŠ é…ç½® æˆ‘è¿™é‡Œä½¿ç”¨nodePortæ–¹å¼ï¼š externalAccess: enabled: true service: type: &quot;NodePort&quot; autoDiscovery: enabled: true serviceAccount: create: true rbac: create: true æ³¨æ„è¿™é‡Œéœ€è¦åˆ›å»ºé¢å¤–çš„svc ä»¥æˆ‘è¿™é‡Œä¸ºä¾‹ï¼Œä¸‰ä¸ªcluster éœ€è¦åˆ›å»ºä¸‰ä¸ªsvcï¼Œkafka-0-external kafka-1-external kafka-2-external kind: Service apiVersion: v1 metadata: name: kafka-{num}-external namespace: database spec: ports: - name: port protocol: TCP port: 9094 targetPort: 9094 selector: statefulset.kubernetes.io/pod-name: kafka-{num} type: NodePort sessionAffinity: None externalTrafficPolicy: Cluster è¿™æ ·è¿è¡Œèµ·æ¥ï¼Œå°±å¯ä»¥é€šè¿‡nodeip:nodeport æ¥è®¿é—®k8så†…çš„kafkaæœåŠ¡äº† $&gt; kubectl get svc -n database kafka-0-external NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kafka-0-external NodePort 10.103.255.3 &lt;none&gt; 9094:32402/TCP 19h ä»¥ä¸Šé¢çš„è¿™ä¸ªä¸ºä¾‹ï¼Œæˆ‘ä»¬çš„èŠ‚ç‚¹ipæ˜¯ï¼š192.168.1.3 é‚£ä¹ˆåœ¨k8s å¤–éƒ¨ï¼Œå°±å¯ä»¥ä½¿ç”¨192.168.1.3:32402 ä»¥æ­¤ç±»æ¨ï¼Œå…¶ä»–ä¸¤ä¸ªclusterä¹Ÿå¯ä»¥è¿™æ ·è®¿é—®ï¼Œä¸è¿‡æ˜¯nodeportä¸ä¸€æ ·è€Œå·² â¯ kubectl get svc -n database NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kafka-0-external NodePort 10.103.255.3 &lt;none&gt; 9094:32402/TCP 19h kafka-1-external NodePort 10.106.84.112 &lt;none&gt; 9094:31626/TCP 19h kafka-2-external NodePort 10.100.211.212 &lt;none&gt; 9094:32458/TCP 19h è¿˜å¯ä»¥é€šè¿‡ç»Ÿä¸€çš„NodePort-svc å°†headlessæš´éœ²è‡³å¤–éƒ¨ å‚è€ƒï¼šå°† headless service æ˜ å°„åˆ°å¤–ç½‘ - ç®€ä¹¦ (jianshu.com) â¯ kubectl expose svc kafka-headless --name=kafka-external --type=LoadBalancer --port=9094 --target-port=9094 -n database â¯ kubectl get svc -n database kafka-external NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kafka-external LoadBalancer 10.105.60.175 192.168.1.244 9094:32002/TCP 19h è¿™æ ·ä¹Ÿå¯ä»¥ä½¿ç”¨192.168.1.3:32002 æ­å»ºkafka-ui æ–‡æ¡£ï¼šprovectus/kafka-ui: Open-Source Web UI for Apache Kafka Management (github.com) å…ˆä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œk8så†…éƒ¨çš„kafka å¯ä»¥ç›´æ¥ä½¿ç”¨headlessæœåŠ¡åœ°å€ kafka-ui-config.yaml: apiVersion: v1 kind: ConfigMap metadata: name: kafka-ui-config namespace: database data: config.yml: |- kafka: clusters: - name: k8s bootstrapServers: kafka-headless.database.svc.cluster.local:9092 auth: type: disabled management: health: ldap: enabled: false ä½¿ç”¨k8sæ­å»º kubectl apply -f kafka-ui-config.yaml helm repo add kafka-ui https://provectus.github.io/kafka-ui helm install my-kafka-ui -n database --set yamlApplicationConfigConfigMap.name=&quot;kafka-ui-config&quot;,yamlApplicationConfigConfigMap.keyName=&quot;config.yml&quot; kafka-ui/kafka-ui --version 0.4.5 ","link":"https://blog.marun.run/k8s-an-zhuang-kafka-kafka-ui/"},{"title":"Istio æœåŠ¡ç½‘æ ¼å¯åŠ¨é¡ºåº","content":"è®°å½•ä¸€ä¸‹istioæœåŠ¡ç½‘æ ¼çš„é—®é¢˜ å‰è¨€ å¦‚æœå¯ç”¨äº†istio æœåŠ¡ç½‘æ ¼ï¼Œé‚£ä¹ˆä¼šè‡ªåŠ¨çš„æ³¨å…¥ istio-proxy sidecar è¿™é‡Œçš„proxyå®¹å™¨ä¸æˆ‘ä»¬çš„ä¸šåŠ¡å®¹å™¨å¯åŠ¨é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œå¦‚æœåœ¨istio-proxyæœªæ­£ç¡®å¯åŠ¨ä¹‹å‰ï¼Œåœ¨ä¸šåŠ¡å®¹å™¨ä¸­å°±å°è¯•å¯¹å¤–è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå‡ºç°é—®é¢˜ã€‚ ä¾‹å¦‚ï¼šæ•°æ®åº“è¿æ¥ redisè¿æ¥åˆå§‹åŒ–é—®é¢˜ æ‰€ä»¥éœ€è¦æ³¨æ„åœ¨ä¸šåŠ¡ä»£ç ä¸­åšå¥½é‡è¯•ï¼Œå½“ç„¶ç°åœ¨å¤§å¤šæ•°æ¡†æ¶éƒ½è‡ªå¸¦é‡è¿æœºåˆ¶ã€‚ ä½†åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œä¸€æ—¦å¼€å¯äº†æ—¥å¿—å‘Šè­¦ï¼Œæ¯æ¬¡æœåŠ¡é‡å¯å°±ä¼šå¯¼è‡´ä¸€å †å‘Šè­¦ï¼Œä¼šå¾ˆéº»çƒ¦ï¼Œè¿™ä¸ªæ—¶å€™å°±è¿˜æ˜¯éœ€è¦æ§åˆ¶ä¸€ä¸‹istio æœåŠ¡ç½‘æ ¼å®¹å™¨çš„å¯åŠ¨ã€‚ è§£å†³æ–¹æ³• é«˜ç‰ˆæœ¬ä½¿ç”¨istioè‡ªå¸¦é…ç½® è‡ªIstio 1.7 ç‰ˆæœ¬å¼€å§‹ï¼Œå¢åŠ äº†holdApplicationUntilProxyStartsé…ç½®é¡¹ï¼Œè§£å†³ä¸Šè¿°é—®é¢˜ å‚è€ƒå®˜ç½‘çš„changelog ä½ç‰ˆæœ¬ä½¿ç”¨æ‰‹åŠ¨æ§åˆ¶ istio-proxy æœ‰ä¸€ä¸ªå¥åº·æ£€æŸ¥çš„æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸»åŠ¨æ¢æµ‹çš„æ–¹å¼æ¥ç¡®è®¤istio-proxyå¯åŠ¨å®Œæˆï¼Œæœ€åå†å¯åŠ¨è‡ªå·±çš„æœåŠ¡ while [[ &quot;$(curl -s -o /dev/null -w ''%{http_code}'' localhost:15020/healthz/ready)&quot; != '200' ]]; do echo Waiting for Sidecar;sleep 1; done; echo Sidecar available; ./http æ³¨æ„ä»¥ä¸Šè„šæœ¬ æœ€åçš„./http è¯·æ›¿æ¢æˆè‡ªå·±çš„ä¸šåŠ¡è¿è¡Œè„šæœ¬ å¦‚æœè¿è¡Œå‚æ•°è¿‡å¤šï¼Œå¯ä»¥è‡ªè¡Œç¼–å†™start.sh å¯åŠ¨è„šæœ¬ï¼Œæˆ–è€…ä½¿ç”¨supervision å‚è€ƒï¼š https://zhuanlan.zhihu.com/p/369301902 ","link":"https://blog.marun.run/istio-fu-wu-wang-ge-qi-dong-shun-xu/"},{"title":"kotlin jackson  missing type id property '@class'","content":"ä½¿ç”¨kotlin æ­é…redis å­˜å‚¨jsonæ ¼å¼æ•°æ®çš„é—®é¢˜ Redis é…ç½®å¦‚ä¸‹ @Bean public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) { RedisTemplate&lt;String, Object&gt; redisTemplate = new RedisTemplate&lt;&gt;(); redisTemplate.setConnectionFactory(redisConnectionFactory); // json åºåˆ—åŒ– redisTemplate.setValueSerializer(RedisSerializer.json()); RedisSerializer&lt;String&gt; stringRedisSerializer = RedisSerializer.string(); // ä½¿ç”¨StringRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„keyå€¼ redisTemplate.setKeySerializer(stringRedisSerializer); // hashçš„keyä¹Ÿé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼ redisTemplate.setHashKeySerializer(stringRedisSerializer); // hashçš„valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson redisTemplate.setHashValueSerializer(RedisSerializer.json()); return redisTemplate; } åœ¨ä½¿ç”¨redistemplate æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨jsonæ ¼å¼é»˜è®¤å­˜å‚¨valueï¼Œç„¶åå‘ç°æ¯æ¬¡å­˜è¿›å»çš„æ•°æ®éƒ½ä¼šå°‘@class åœ¨å–å‡ºæ•°æ®ååºåˆ—åŒ–çš„æ—¶å€™ä¼šæŠ¥é”™ GenericJackson2JsonRedisSerializer æ–‡ä»¶ public GenericJackson2JsonRedisSerializer(@Nullable String classPropertyTypeName) { this(new ObjectMapper()); registerNullValueSerializer(this.mapper, classPropertyTypeName); if (StringUtils.hasText(classPropertyTypeName)) { this.mapper.enableDefaultTypingAsProperty(DefaultTyping.NON_FINAL, classPropertyTypeName); } else { this.mapper.enableDefaultTyping(DefaultTyping.NON_FINAL, As.PROPERTY); } } æŸ¥çœ‹æºç ï¼Œå‘ç°åœ¨è¿™ä¸ªjacksonçš„é…ç½®ä¸­ï¼Œé»˜è®¤ä½¿ç”¨äº†DefaultTyping.NON_FINAL è€Œåœ¨ kotlinä¸­ æˆ‘ä»¬çš„ç±» é»˜è®¤æ˜¯finalçš„ éœ€è¦æ·»åŠ åœ¨ç±»å‰é¢æ·»åŠ openä¿®é¥°ç¬¦ æˆ–è€…ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä½¿ç”¨è‡ªå®šä¹‰objectMapper å¹¶è®¾ç½® ObjectMapper.DefaultTyping.EVERYTHING ","link":"https://blog.marun.run/kotlin-jackson-missing-type-id-property-class/"},{"title":"Mybastis Plus ä½¿ç”¨mapper.xml","content":"è®°å½•ä¸€ä¸‹mybatis plus ä¸­mapperçš„ä½¿ç”¨ mybatis pluså®˜ç½‘ åˆ†é¡µå™¨é…ç½® @Configuration public class MybatisPlusConfig { @Bean public MybatisPlusInterceptor mybatisPlusInterceptor() { MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor(); interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL)); return interceptor; } } mapper.xml: &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt; &lt;mapper namespace=&quot;mapper.HiProcinstMapper&quot;&gt; &lt;select id=&quot;getTodoList&quot; resultType=&quot;model.HiProcinstModel&quot;&gt; select PROC.* from ACT_HI_PROCINST PROC left join ACT_RU_TASK TASK on PROC.PROC_INST_ID_ = TASK.PROC_INST_ID_ ${ew.customSqlSegment} &lt;/select&gt; &lt;!-- --&gt; &lt;select id=&quot;getDoneList&quot; resultType=&quot;model.HiProcinstModel&quot;&gt; select PROC.* from ACT_HI_PROCINST PROC left join ACT_HI_TASKINST TASK on PROC.PROC_INST_ID_ = TASK.PROC_INST_ID_ ${ew.customSqlSegment} &lt;/select&gt; &lt;/mapper&gt; mapper.kt package mapper; import com.baomidou.mybatisplus.core.conditions.Wrapper import model.HiProcinstModel; import com.baomidou.mybatisplus.core.mapper.BaseMapper; import com.baomidou.mybatisplus.core.metadata.IPage import com.baomidou.mybatisplus.core.toolkit.Constants import org.apache.ibatis.annotations.Param import org.apache.ibatis.annotations.Select interface HiProcinstMapper : BaseMapper&lt;HiProcinstModel&gt; { /** * è·å–ä»£åŠåˆ—è¡¨ */ fun getTodoList( page:IPage&lt;HiProcinstModel&gt;,@Param(Constants.WRAPPER) wrapper: Wrapper&lt;HiProcinstModel&gt;) : IPage&lt;HiProcinstModel&gt; /** * è·å–å·²å¤„ç†åˆ—è¡¨ */ fun getDoneList( page:IPage&lt;HiProcinstModel&gt;,@Param(Constants.WRAPPER) wrapper: Wrapper&lt;HiProcinstModel&gt;) : IPage&lt;HiProcinstModel&gt; } æˆ‘ä»¬åªåœ¨mapper.xmlä¸­å†™äº†å…³è”æŸ¥è¯¢çš„è¯­å¥ï¼Œå…¶ä»–æŸ¥è¯¢æ¡ä»¶å’Œåˆ†é¡µæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨äº†mybatisPlusçš„åˆ†é¡µæ’ä»¶ å’ŒQueryWrapper åœ¨Serviceä¸­è°ƒç”¨ @Service open class HiProcinstServiceImpl : ServiceImpl&lt;HiProcinstMapper, HiProcinstModel&gt;(), IHiProcinstService { @Resource lateinit var processEngine: ProcessEngine /** * å¾…å®¡æ‰¹åˆ—è¡¨ */ override fun getTodoList(userId: String, pageParams: PageParams): Pagination&lt;ProcInstVo&gt; { val queryWrapper = QueryWrapper&lt;HiProcinstModel&gt;() // ä»»åŠ¡åˆ†é…ç»™å½“å‰ç”¨æˆ· .eq(&quot;TASK.${HiTaskinstModel.ASSIGNEE_}&quot;, userId) // å¹¶ä¸”æ˜¯æ´»åŠ¨ä¸­çš„ä»»åŠ¡ .eq(&quot;PROC.${HiProcinstModel.STATE_}&quot;, HistoricProcessInstance.STATE_ACTIVE) .orderByAsc(&quot;PROC.${HiProcinstModel.START_TIME_}&quot;) val todoList = this.baseMapper.getTodoList(Page(pageParams.page, pageParams.pageSize), queryWrapper) return Pagination(this.convert2Vo(todoList)) } /** * å·²å¤„ç†æµç¨‹å®ä¾‹ */ override fun getDoneList(userId: String, pageParams: PageParams): Pagination&lt;ProcInstVo&gt; { val queryWrapper = QueryWrapper&lt;HiProcinstModel&gt;() // ä»»åŠ¡åˆ†é…ç»™å½“å‰ç”¨æˆ· .eq(&quot;TASK.${HiTaskinstModel.ASSIGNEE_}&quot;, userId) // å¹¶ä¸”ä»»åŠ¡å·²å®Œæˆ .isNotNull(&quot;TASK.${HiTaskinstModel.END_TIME_}&quot;) .orderByDesc(&quot;PROC.${HiProcinstModel.START_TIME_}&quot;) val doneList = this.baseMapper.getDoneList(Page(pageParams.page, pageParams.pageSize), queryWrapper) return Pagination(this.convert2Vo(doneList)) } } ","link":"https://blog.marun.run/mybastis-plus-shi-yong-mapperxml/"},{"title":"Springboot æ³¨å†ŒServletContextListener  ä¸context-paramsä½¿ç”¨","content":"èƒŒæ™¯è¯´æ˜ï¼š åœ¨springbootä¸­ä½¿ç”¨ camunda-rest ä¼šæœ‰é…ç½®æ—¥æœŸæ ¼å¼çš„éœ€æ±‚ è€ŒæŒ‰ç…§æ–‡æ¡£æ¥é…ç½® éœ€è¦é…ç½®åœ¨WEB-INF/web.xmlé‡Œï¼Œåœ¨springbootä¸­æˆ‘ä»¬å¹¶ä¸éœ€è¦é…ç½®è¿™ä¸ªweb.xml æ³¨å†Œcamundaçš„Listenteråˆ°springbootä¸­ï¼š @Configuration public class MyConfiguration { /** * æŠŠè‡ªå®šä¹‰çš„listeneræ³¨å†Œåˆ°å®¹å™¨ä¸­ * @return */ @Bean public ServletListenerRegistrationBean customJacksonDateFormatListener(){ ServletListenerRegistrationBean&lt;CustomJacksonDateFormatListener&gt; registrationBean = new ServletListenerRegistrationBean&lt;&gt;(new CustomJacksonDateFormatListener()); return registrationBean; } } åœ¨application.yamlä¸­é…ç½®context-param server: servlet: context-parameters: org.camunda.bpm.engine.rest.jackson.dateFormat: yyyy-MM-dd HH:mm:ss ","link":"https://blog.marun.run/springboot-zhu-ce-servletcontextlistener-yu-context-params-shi-yong/"},{"title":"Mac m1 å®‰è£…swoole  ç¢°åˆ°çš„é—®é¢˜","content":"ä½¿ç”¨pecl install swoole æŠ¥é”™ ä¸€.openssl not found ä½¿ç”¨brew install openssl --enable-openssl --with-openssl-dir=/opt/homebrew/Cellar/openssl@3/3.0.1/ äºŒ. library not found for -latomic ä½¿ç”¨ brew install gcc åˆ‡æ¢gccä¸ºbrewå®‰è£…çš„ç‰ˆæœ¬ export CC=gcc-11 export CXX=g++-11 ä¸‰. pcre2.h not found ä½¿ç”¨brew install pcre2 ç„¶åè½¯é“¾åˆ°ä½ å½“å‰ä½¿ç”¨çš„phpç‰ˆæœ¬ä¸‹çš„pcre ln -s /opt/homebrew/Cellar/pcre2/10.39/include/pcre2.h /opt/homebrew/Cellar/php@7.3/7.3.31_1/include/php/ext/pcre/pcre2.h ä»¥ä¸Šè·¯å¾„éœ€è¦æ”¹æˆæ‚¨è‡ªå·±çš„è·¯å¾„ ","link":"https://blog.marun.run/mac-m1-an-zhuang-swoole-peng-dao-de-wen-ti/"},{"title":"activiti, camunda, ä¼šç­¾ æˆ–ç­¾","content":"ä¼šç­¾ï¼Œæˆ–ç­¾ï¼Œä¾æ¬¡å®¡æ‰¹å€ŸåŠ©äºmulti-instance Multi-Instance | Camunda Cloud Docs Activiti User Guide å¤šå®ä¾‹ä»»åŠ¡ï¼š å¯ä»¥ç†è§£ä¸ºå¯é‡å¤æ‰§è¡Œçš„ä»»åŠ¡ å¦‚ä½•å®šä¹‰é‡å¤æ‰§è¡Œçš„æ¬¡æ•° ï¼Ÿ ä¸€. loopCardinality å¯ä»¥è®¾ç½®ä¸€ä¸ªå›ºå®šçš„å¾ªç¯ä¸Šé™ã€‚ &lt;multiInstanceLoopCharacteristics isSequential=&quot;true&quot;&gt; &lt;loopCardinality&gt;5&lt;/loopCardinality&gt; &lt;/multiInstanceLoopCharacteristics&gt; å½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œå†™ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç”¨äºè®¡ç®—å‡ºä¸€ä¸ªæ­£æ•´æ•°å¾ªç¯æ¬¡æ•° &lt;multiInstanceLoopCharacteristics isSequential=&quot;true&quot;&gt; &lt;loopCardinality&gt;${nrOfOrders-nrOfCancellations}&lt;/loopCardinality&gt; &lt;/multiInstanceLoopCharacteristics&gt; äºŒ. Collection è®¾ç½®ä¸€ä¸ªå¾ªç¯è®¿é—®é›†åˆ è®¾ç½®å›ºå®šçš„å¯å¾ªç¯è®¿é—®çš„é›†åˆï¼šcollection=[&quot;marin&quot;, &quot;monkey&quot;] &lt;userTask id=&quot;miTasks&quot; name=&quot;My Task&quot; activiti:assignee=&quot;${assignee}&quot;&gt; &lt;multiInstanceLoopCharacteristics isSequential=&quot;false&quot; activiti:collection=&quot;[&quot;marin&quot;,&quot;monkey&quot;]&quot; activiti:elementVariable=&quot;assigner&quot; &gt; &lt;/multiInstanceLoopCharacteristics&gt; &lt;/userTask&gt; å¹¶é€šè¿‡elementVariableå°†å¾ªç¯å–å‡ºçš„å€¼èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ã€‚ åœ¨ä¸Šé¢çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªå›ºå®šçš„é›†åˆ[&quot;marin&quot;,&quot;monkey&quot;],å°†elementVariable è®¾ç½®ä¸ºassignerã€‚å¹¶å°†userTaskçš„assigneeè®¾ç½®ä¸º${assigner} ã€‚ è¿™ä¹Ÿå°±æ˜¯ä»£è¡¨ç€ï¼Œåœ¨è¿™ä¸ªå¤šä¾‹ä»»åŠ¡ä¸­ï¼Œä¼šåˆ›å»ºä¸¤ä¸ªuserTask,å¹¶ä¾æ¬¡å°†è¿™ä¸¤ä¸ªä»»åŠ¡åˆ†é…ç»™marin,monkeyã€‚ ä½¿ç”¨å˜é‡å¡«å…… collectionã€‚ &lt;userTask id=&quot;miTasks&quot; name=&quot;My Task&quot; activiti:assignee=&quot;${assigner}&quot;&gt; &lt;multiInstanceLoopCharacteristics isSequential=&quot;true&quot; activiti:collection=&quot;assignerList&quot; activiti:elementVariable=&quot;assigner&quot; &gt; &lt;/multiInstanceLoopCharacteristics&gt; &lt;/userTask&gt; æˆ‘ä»¬å¯ä»¥åœ¨å‘èµ·å®ä¾‹çš„æ—¶å€™ä¼ å…¥ä¸€ä¸ªå˜é‡assignerList RuntimeService runtimeService = processEngine.getRuntimeService(); Map&lt;String, Object&gt; variables = new HashMap&lt;&gt;(); variables.put(&quot;assignerList&quot;, Arrays.asList(&quot;marin&quot;, &quot;monkey&quot;, &quot;roy&quot;)); runtimeService.startProcessInstanceByKey(&quot;multiple&quot;, variables); ä½¿ç”¨springï¼ŒæœåŠ¡ &lt;userTask id=&quot;miTasks&quot; name=&quot;My Task&quot; activiti:assignee=&quot;${assigner}&quot;&gt; &lt;multiInstanceLoopCharacteristics isSequential=&quot;false&quot; activiti:collection=&quot;${userService.getApprovalAssigners()}&quot; activiti:elementVariable=&quot;assigner&quot; &gt; &lt;/multiInstanceLoopCharacteristics&gt; &lt;/userTask&gt; å¦‚æœæˆ‘ä»¬ä½¿ç”¨spring bootï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè°ƒç”¨ä»£ç ä¸­çš„æŸä¸ªæœåŠ¡æŸä¸ªæ–¹æ³•æ¥è·å–ä¸€ä¸ªé›†åˆ æ³¨æ„âš ï¸ï¼Œè¿™é‡Œçš„userService å¿…é¡»åœ¨spring ä¸­æ³¨å†Œä¸º Spring Bean Service æ³¨æ„âš ï¸ï¼Œä¸€ä¸ªå¤šå®ä¾‹æ´»åŠ¨å¿…é¡»è¦æœ‰loopCardinalityï¼Œæˆ–è€…collection å…¶ä¸­ä¸€ä¸ªï¼Œå¦åˆ™æ‰§è¡Œå‡ºé”™ã€‚ å¦‚ä½•ç»ˆæ­¢è¿è¡Œï¼Ÿ é»˜è®¤åœ¨æ‰€æœ‰å¤šå®ä¾‹ä»»åŠ¡éƒ½å®Œæˆä¹‹åï¼Œé‚£ä¹ˆè¿™ä¸ªå¤šå®ä¾‹ä»»åŠ¡ä¹Ÿå°±å®Œæˆäº†ã€‚ æˆ–è€…ä½ å¯ä»¥å®šä¸€ä¸ªå®Œæˆæ¡ä»¶ï¼šcompletionCondition &lt;userTask id=&quot;miTasks&quot; name=&quot;My Task&quot; activiti:assignee=&quot;${assigner}&quot;&gt; &lt;multiInstanceLoopCharacteristics isSequential=&quot;false&quot; activiti:collection=&quot;${userService.getApprovalAssigners()}&quot; activiti:elementVariable=&quot;assigner&quot; &gt; &lt;completionCondition&gt;${nrOfCompletedInstances/nrOfInstances &gt;= 0.6 }&lt;/completionCondition&gt; &lt;/multiInstanceLoopCharacteristics&gt; &lt;/userTask&gt; ä»¥ä¸‹ä¸ºé»˜è®¤çš„å¤šå®ä¾‹å˜é‡ã€‚ nrOfInstances: å®ä¾‹æ€»æ•°ï¼ˆä»»åŠ¡æ€»æ•°ï¼‰ï¼Œå¯¹åº”collectionçš„sizeï¼ŒloopCardinalityçš„å€¼ nrOfActiveInstances: å½“å‰æ´»åŠ¨çš„å®ä¾‹æ•°ï¼Œå¯¹äºä¸²è¡Œçš„å¤šå®ä¾‹æ¥è¯´ï¼Œè¿™ä¸ªå€¼ä¸€ç›´éƒ½æ˜¯1 nrOfCompletedInstances: å·²å®Œæˆå®ä¾‹æ•° ä¸Šé¢çš„ä¾‹å­ä»£è¡¨ï¼Œå¦‚æœæœ‰60%çš„ä»»åŠ¡å·²ç»å®Œæˆï¼Œé‚£ä¹ˆå½“å‰å¤šå®ä¾‹å°±å®Œæˆäº†ã€‚ å½“ç„¶ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥å†™è¡¨è¾¾å¼ï¼Œæˆ–è€…è°ƒç”¨spring çš„serviceï¼Œåªè¦è¿”å›çš„æ˜¯ä¸€ä¸ªboolå€¼å°±ok å¹¶ç­¾ï¼š å¹¶ç­¾å¯¹åº” parallel multi-instance å¹¶è¡Œçš„å¤šå®ä¾‹ï¼Œå¦‚ä¸‹å›¾ï¼ˆå›¾ç‰‡æ¥è‡ªcanmundaï¼‰ ä¾‹å¦‚ï¼šè¿™ä¸€æ¬¡å¤šå®ä¾‹å®¡æ‰¹ï¼ŒæŒ‡å®šäº†ä¸¤ä¸ªäººã€‚ ä¼šåŒæ—¶ç”Ÿæˆä¸¤ä¸ªtaskï¼Œè¿™ä¸¤ä¸ªtaskæ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œåªæœ‰å½“è¿™ä¸¤ä¸ªç‹¬ç«‹çš„taskéƒ½å®Œæˆæ—¶æ‰ä¼šèµ°åˆ°ä¸‹ä¸€æ­¥ã€‚ å½“ç„¶æˆ‘ä»¬å¯ä»¥åœ¨å¤šå®ä¾‹ä»»åŠ¡ä¸Šå®šä¹‰ç»ˆæ­¢æ¡ä»¶ï¼Œæå‰ç»“æŸå¤šä¾‹ä»»åŠ¡ã€‚ åæ–‡çš„æˆ–ç­¾å°±æ˜¯åŸºäºæ­¤å®ç°ã€‚ å¹¶è¡Œçš„å¤šå®ä¾‹æ˜¯åœ¨æµç¨‹è¿è¡Œè‡³æ­¤çš„æ—¶å€™ï¼Œä¸€æ¬¡ç”Ÿæˆå¤šä¸ªä»»åŠ¡ã€‚ ä¾æ¬¡å®¡æ‰¹ï¼š ä¾æ¬¡å®¡æ‰¹å¯¹åº” sequential multi-instance ä¸²è¡Œçš„å¤šå®ä¾‹ é¦–å…ˆç”Ÿæˆç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªä»»åŠ¡å®Œæˆåæ‰ä¼šç”Ÿæˆç¬¬äºŒä¸ªä»»åŠ¡ï¼Œç›´åˆ°æ‰€æœ‰çš„ä»»åŠ¡å®Œæˆ æˆ–ç­¾ï¼š æˆ–ç­¾å¯¹åº”çš„ä¹Ÿæ˜¯parallel multi-instance, ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬ä¼šè®¾ç½®ä¸€ä¸ªcompletionCondition=&quot;${nrOfCompletedInstances==1}&quot; ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼šä¸€æ¬¡ç”Ÿæˆå¤šä¸ªä»»åŠ¡ï¼Œåªè¦æœ‰å…¶ä¸­ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼Œé‚£ä¹ˆæ•´ä¸ªå¤šå®ä¾‹ä»»åŠ¡éƒ½è¢«è§†ä¸ºå®Œæˆäº†ã€‚ ","link":"https://blog.marun.run/activiti-camunda-hui-qian-huo-qian/"},{"title":"mysql view å­—ç¬¦é›†æ’åºæŠ¥é”™","content":"General error: 1267 Illegal mix of collations åœ¨ä½¿ç”¨mysqlè§†å›¾æ—¶ï¼ŒæŠ¥é”™ SQLSTATE[HY000]: General error: 1267 Illegal mix of collations (utf8mb4_general_ci,COERCIBLE) and (utf8mb4_unicode_ci,COERCIBLE) for operation '=' é€šè¿‡å‘½ä»¤ SHOW CREATE TABLE view_table_name; æŸ¥çœ‹å­—ç¬¦é›†ï¼Œä»¥åŠæ’åºè§„åˆ™ character_set_client collation_connection utf8mb4 utf8mb4_general_ci å‘ç°è§†å›¾çš„æ’åºè§„åˆ™é”™è¯¯ã€‚ åˆ é™¤åŸæœ‰view å¹¶é‡å»º -- è®¾ç½®æ’åºè§„åˆ™ SET collation_connection = utf8mb4_unicode_ci; -- åˆ é™¤åŸæœ‰çš„view drop VIEW view_table_name; -- é‡æ–°æ–°å»ºview create view view_table_name .... å¦‚æœæ˜¯å­—ç¬¦é›†æŠ¥é”™ï¼ŒåŒç†ä¿®æ”¹å³å¯ã€‚ SET character_set_client = utf8mb4; SET character_set_results = utf8mb4; SET character_set_connection = utf8mb4; å‚è€ƒèµ„æ–™ï¼š https://stackoverflow.com/questions/9422189/why-is-my-view-utf8-and-how-can-i-change-it-to-latin1 ","link":"https://blog.marun.run/mysql-view-zi-fu-ji-pai-xu-bao-cuo/"},{"title":"éƒ¨ç½² packagistç§æœ æ­é…gitlab ç§æœä½¿ç”¨ ","content":"éƒ¨ç½²packagist æ­é…gitlabä½¿ç”¨ æºç åœ°å€ï¼šcomposer/packagist ç¬”è€…åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™å¯¹åº”çš„commit sha :aa0d63fd6ebbfd991aa3ab652d33c6c8e463543a å› ä¸ºpackagistæ²¡æœ‰ç‰ˆæœ¬çš„æ¦‚å¿µ æ‰€ä»¥ä½¿ç”¨commit sha çš„æ–¹å¼æ¥è®°å½•ä¸€ä¸‹ ç¯å¢ƒå®‰è£… ç”±äºæœ€æ–°ç‰ˆä½¿ç”¨çš„æ˜¯php8.0,æ‰€ä»¥æ¥å®‰è£…ä¸€ä¸‹8.0 ä½¿ç”¨aptå®‰è£…php8.0 sudo apt install php8.0 php8.0-bcmath php8.0-redis php8.0-cli php8.0-zip php8.0-mysql php8.0-http php8.0-curl php8.0-common php8.0-raphf php8.0-dev php8.0-mbstring php8.0-dom php8.0-xml å®‰è£…è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼ŒåŸºæœ¬å¦‚ä¸Š åœ¨å®‰è£…å®Œæˆåï¼Œcomposer install æ—¶å‡ºç°unrecognised compile-time option bit(s) æŒ‰ç…§è¿™ä¸ªissure åªç”¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼ˆå¦‚æœä½ æ²¡æœ‰å‡ºç°ä»»ä½•é—®é¢˜ï¼Œæ— è§†å³å¯ï¼‰ sudo apt-get install --only-upgrade libpcre2-16-0 libpcre2-32-0 libpcre2-8-0 libpcre2-dev libpcre2-posix2 é¡¹ç›®éƒ¨ç½² git clone https://github.com/composer/packagist.git &amp;&amp; cd packagist é¡¹ç›®é…ç½® æ‹‰å–ä»£ç ä¹‹åï¼Œå…ˆé…ç½®ä¸€ä¸‹redis,database ç­‰ç­‰ æ‰“å¼€.envæ–‡ä»¶ # æ•°æ®åº“é…ç½®ï¼Œ ä¿®æ”¹æˆè‡ªå·±çš„é…ç½®ï¼Œå¹¶ç¡®ä¿æ‹¥æœ‰packagiståº“ DATABASE_URL=&quot;mysql://root:123456@127.0.0.1:3306/packagist?serverVersion=8.0&quot; # ALGOLIA é…ç½®,æœç´¢ç”¨ã€‚ å¯å‰å¾€ https://www.algolia.com/ æ³¨å†Œï¼Œå…è´¹ä½¿ç”¨ï¼Œå¦‚æœåªæ˜¯å°è¯•æœ¬åœ°éƒ¨ç½²ï¼Œå¯å¿½ç•¥ ALGOLIA_APP_ID=xxx ALGOLIA_ADMIN_KEY=xxx ALGOLIA_SEARCH_KEY=xxx ALGOLIA_INDEX_NAME=xxx # redis é…ç½®ï¼Œå¯æ¢æˆè‡ªå·± REDIS_URL=redis://localhost # è°·æ­Œçš„ä¸€ä¸ªéªŒè¯ï¼Œæˆ‘åœ¨ä½¿ç”¨æ—¶ï¼Œè¿™é‡Œä¼šæœ‰ç‚¹é—®é¢˜ï¼Œä¸‹é¢ä¼šè®²ã€‚ ###&gt; beelab/recaptcha2-bundle ### APP_RECAPTCHA_ENABLED=false APP_RECAPTCHA_SITE_KEY=needed APP_RECAPTCHA_SECRET=needed ###&lt; beelab/recaptcha2-bundle ### apcuç¼“å­˜é”™è¯¯ config/packages/cache.yaml æ–‡ä»¶é‡Œçš„system,ä½¿ç”¨çš„apcu,ç”±äºæˆ‘çš„phpæ²¡æœ‰è£…è¿™ä¸ªæ‰©å±•å¯¼è‡´ç¼“å­˜æŠ¥é”™ framework: cache: app: cache.adapter.redis # ä¸‹é¢çš„è¿™ä¸ªsystemç¼“å­˜ ä½¿ç”¨çš„æ˜¯apcuã€‚å¦‚æœä½ æ²¡æœ‰å®‰è£…apcuè¿™ä¸ªphpæ‰©å±•ï¼Œå¯ä»¥æ›¿æ¢æˆå…¶ä»–çš„ # ä¾‹å¦‚ï¼šcache.adapter.redis cache.adapter.filesystem ç­‰ç­‰ system: cache.adapter.apcu default_redis_provider: snc_redis.cache pools: doctrine.cache: null prefix_seed: packagist recaptcha2çš„é—®é¢˜ æŸ¥é˜…ä»¥ä¸‹ä»£ç ã€‚ templates/registration/register.html.twig templates/reset_password/request.html.twig æˆ‘ä»¬ä¼šå‘ç°è¿™ä¸ªè®¾ç½®äº†ä¸€ä¸ªset requiresRecaptcha = trueï¼Œè¿™ä¸ªä¼šè®©æˆ‘ä»¬ä¸Šé¢.envä¸­æ‰€è®¾ç½®çš„APP_RECAPTCHA_ENABLED=false æ— æ•ˆã€‚ è¿™æ ·å°±ä¼šå¯¼è‡´å¦‚æœä½ æ²¡æœ‰è®¾ç½®APP_RECAPTCHA_SITE_KEYå’ŒAPP_RECAPTCHA_SECRETï¼Œé‚£ä¹ˆä½ å°±å°†æ°¸è¿œæ— æ³•æäº¤æ³¨å†Œè¡¨å•ï¼Œå’Œé‡ç½®å¯†ç çš„è¡¨å•ã€‚ è¿™ä¸ªé—®é¢˜å›°æ‰°äº†æˆ‘å¾ˆä¹…ï¼Œå…·ä½“è¡¨ç°ä¸ºï¼Œç‚¹å‡»æ³¨å†ŒæŒ‰é’®ï¼Œæ²¡æœ‰ä»»ä½•ååº”ï¼Œåªæœ‰consoleæ§åˆ¶å°æŠ¥äº†ä¸€ä¸‹recaptcha.jsçš„é”™è¯¯ã€‚ å¦‚æœä½ è·Ÿæˆ‘ä¸€æ ·ï¼Œå¹¶æ²¡æœ‰è®¾ç½®recaptcha,é‚£ä¹ˆä½ éœ€è¦åˆ é™¤ä¸Šé¢ä¸¤ä¸ªä»£ç æ–‡ä»¶ä¸­çš„{% set requiresRecaptcha = true %} å¹¶ä¸”å†æ¬¡é‡æ–° composer installï¼Œæˆ–è€…æ‰‹åŠ¨è¿è¡Œphp bin/console cache:clear å½“ä½ éƒ½å·²ç»å‡†å¤‡å¥½äº†ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨composer installæ¥å®‰è£…ä½ çš„ç¨‹åºäº†ã€‚ ç„¶åä½¿ç”¨symfony serve å¯åŠ¨ä¸€ä¸ªç®€å•çš„webserver å¦‚æœä½ æ²¡æœ‰symfony,è¯·åˆ°è¿™é‡Œä¸‹è½½ä¸€ä¸ª https://symfony.com/download æäº¤è‡ªå·±çš„åŒ… ä¸€æ—¦ä½ æˆåŠŸå®Œæˆä»¥ä¸Šæ“ä½œï¼ŒæˆåŠŸæ³¨å†Œäº†ä¸€ä¸ªè´¦å·ä¹‹åï¼Œä½ å¯ä»¥å°è¯•æäº¤è‡ªå·±çš„ç§æœ‰åŒ…ã€‚ ä¾‹å¦‚ https://github.com/xxx/xxxï¼Œhttps://gitlab.com/xxx/xxx ä½†ï¼Œéœ€è¦è®°ä½çš„æ˜¯ï¼š è¿™ä¸ªé“¾æ¥å¯¹åº”çš„ä»£ç åº“åº”è¯¥æ˜¯ä¸€ä¸ª pulic å…¬å¼€çš„åº“,å¦åˆ™ä½ éœ€è¦åˆ°ä½ éƒ¨ç½²packagisté¡¹ç›®çš„æœºå™¨ä¸Šè®¾ç½®ssh æˆ–è€… è®¾ç½® git clone httpsæ—¶çš„è´¦å·å¯†ç  è€Œä¸”ä½ çš„ä»£ç åº“ä¸­ï¼Œåº”è¯¥æ‹¥æœ‰composer.jsonæ–‡ä»¶ï¼Œå¹¶ä¸”æ­£ç¡®çš„é…ç½®composer.jsonå†…å®¹ã€‚ ä¸€æ—¦æäº¤æˆåŠŸï¼Œä½ å¯ä»¥ç‚¹å‡»updateæŒ‰é’®æ›´æ–°ä½ çš„ç§æœ‰åŒ…ï¼Œè®°ä½è¦åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œphp bin/console packagist:run-workers å½“ç„¶ æœ€åçš„åšæ³•æ˜¯æŒ‰ç…§æ–‡æ¡£ä¸Šçš„ï¼Œåœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨crontab è¿è¡Œä¸Šé¢çš„å‘½ä»¤ã€‚ ä½¿ç”¨è‡ªå·±çš„åŒ… ä¸€æ—¦ä¸Šé¢çš„éƒ½å®Œæˆäº†ï¼Œé‚£ä¹ˆä½ å°±å·²ç»æˆåŠŸçš„æäº¤äº†ä¸€ä¸ªåŒ…åˆ°è‡ªå·±ç§æœ‰çš„packagistä¸Šäº† åœ¨å¦ä¸€ä¸ªé¡¹ç›®ä¸­çš„composer.jsonä¸­åŠ ä¸Š è‡ªå·±çš„ä»“åº“ &quot;repositories&quot;: [ { &quot;type&quot; : &quot;composer&quot;, &quot;url&quot; : &quot;https://packagist.mydomain.com&quot; } ] ç„¶åcomposer require my/packagistï¼Œä½ å°±å¯ä»¥æˆåŠŸçš„ä¸‹è½½ é…ç½®ç§æœ‰çš„gitlab-domains æ­£å¸¸æ¥è¯´ï¼Œæˆ‘ä»¬çš„åŒ…åº”è¯¥æ‹¥æœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œå¹¶ä¸”å¯ä»¥ä¸‹è½½dist ä½†å¦‚æœæˆ‘ä»¬ä½¿ç”¨ç§æœ‰çš„gitlab,æ¯æ¬¡composer install æˆ–è€… composer require æ—¶ æ˜¯ä½¿ç”¨ git cloneçš„æ–¹å¼å»æ‹‰å–æºç ã€‚ ä½ å¯ä»¥ä½¿ç”¨ composer require xxx/xxx -vvvçš„æ–¹å¼æ¥æŸ¥çœ‹composer ä¸‹è½½æ¯ä¸ªåŒ…çš„ç»†èŠ‚ è¿™æ ·å°±ä¼šå¯¹ä½ composer installæ—¶çš„ç¯å¢ƒæœ‰è¦æ±‚ï¼Œå¿…é¡»æ‹¥æœ‰git å‘½ä»¤ã€‚ åœ¨ä¸€äº›k8s,docker é•œåƒä¸­install æ—¶å¯èƒ½ä¼šå‡ºç°ä¸€äº›äº›é—®é¢˜ã€‚ æˆ‘ä»¬åœ¨packagistéƒ¨ç½²çš„æœºå™¨ä¸Šè¿è¡Œä¸‹é¢çš„è¿™ä¸ªå‘½ä»¤ï¼Œå†æ¬¡å»packagistä¸­æ›´æ–°è‡ªå·±çš„åŒ… ç„¶åå†rm -rf vendor &amp;&amp; rm -rf composer.lock &amp;&amp; composer install -vvv ä½ å°±å¯ä»¥çœ‹åˆ°ä»¥distçš„æ–¹å¼å»gitlabä¸‹è½½æºç äº†ï¼Œä¸å†æ˜¯git cloneçš„æ–¹å¼å»å…‹éš†æºç  composer --global config gitlab-domains gitlab.xxx.cn gitlab.com ","link":"https://blog.marun.run/bu-shu-packagist-si-fu-da-pei-gitlab-si-fu-shi-yong/"},{"title":"gitlab-ci/cd","content":"ç®€å•ä»‹ç»gitlab-ci/cdçš„ä½¿ç”¨ å®˜æ–¹æ–‡æ¡£ï¼š GitLab CI/CD æ²¡æœ‰æ¯”å®˜æ–¹æ–‡æ¡£æ›´å¥½ä¸è¿‡çš„æ•™ç¨‹äº†ï¼ gitlab-ciå¦‚ä½•è¿è¡Œï¼Ÿ gitlab-ciå¹¶ä¸æ˜¯å¹³ç™½æ— æ•…è¿è¡Œèµ·æ¥çš„ï¼Œä¾æ‰˜äºä¸€ä¸ªå«åšGitLab Runner çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬é…ç½®çš„gitlab-ci æ‰ä¼šé¡ºåˆ©çš„è¿è¡Œã€‚ å¦‚æœä½ å¯¹Install GitLab Runner æ„Ÿå…´è¶£ï¼Œå¯ä»¥å‚çœ‹æ–‡æ¡£ï¼Œgitlab-runneræ˜¯å¦‚ä½•å®‰è£…çš„ã€‚ ci/cdçš„è¿è¡Œ è‡³å°‘éœ€è¦ä¸€ä¸ªgitlab-runnerã€‚å½“ç„¶ä¹Ÿå¯ä»¥é…ç½®å¤šä¸ªï¼Œæ¯”å¦‚æ‚¨å¯ä»¥åœ¨macosç³»ç»Ÿä¸Šå®‰è£…gitlab-runnerå¹¶æ³¨å†Œåˆ°gitlabä¸­ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥å°†ç±»ä¼¼iosæ‰“åŒ…çš„è¿‡ç¨‹æ”¾åˆ°è¿™ä¸ªrunnerä¸Šäº†ã€‚ä»¥æ­¤ç±»æ¨ï¼Œå¦‚æœæ‚¨æœ‰ç‰¹æ®Šè¦æ±‚çš„ci/cdï¼Œå¯ä»¥æŒ‡å®šç‰¹æ®Šçš„runnerã€‚ ci/cdè¿è¡Œè¿‡ç¨‹ï¼š gitlabæŒ‰ç…§æ‚¨é¡¹ç›®ä¸­çš„çš„gitlab-ci.yamlé…ç½®ï¼Œåˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªjob,ç„¶åç­‰å¾…gitlab-runnerè¿è¡Œè¿™äº›jobã€‚ å¤§æ¦‚çš„è¿‡ç¨‹ç±»ä¼¼äºï¼š é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œå™¨ ä¹Ÿå°±æ˜¯æ‰§è¡Œå‘½ä»¤ç­‰æ“ä½œçš„ç¯å¢ƒï¼Œéœ€è¦gitlab-runnerä¸­é…ç½®ã€‚ä¾‹å¦‚shellä¹Ÿå°±æ˜¯åœ¨gitlab-runnerä¸»æœºä¸Šè¿è¡Œã€‚dockerå°±æ˜¯æ‹‰å–æŸä¸ªé•œåƒï¼Œåœ¨é•œåƒä¸­æ‰§è¡Œå‘½ä»¤ã€‚ ä¸‹æ–‡çš„runnerçš„æ‰§è¡Œå™¨å‡ä¸ºdocker æ‹‰å–æºç  é‡å»ºç¼“å­˜ å¦‚æœå½“å‰jobæˆ–è€…æµæ°´çº¿æœ‰é…ç½®ç¼“å­˜ï¼Œä¼šæ‹‰å–ç¼“å­˜ã€‚ï¼ˆä¸‹æ–‡è¯¦ç»†è¯´ï¼‰ ä¸‹è½½artifacts å¦‚æœå½“å‰jobçš„ä¸Šæ¸¸æœ‰é…ç½®artifactsï¼Œä¼šä¸‹è½½artifactsï¼ˆä¸‹æ–‡è¯¦ç»†è¯´ï¼‰ æ‰§è¡Œå‘½ä»¤ æ‰§è¡Œæ‚¨çš„scripts CI/CD pipelines æµæ°´çº¿ é¡¾åæ€ä¹‰ï¼Œæµæ°´çº¿ ï¼Œä¹Ÿå°±æ˜¯å®šä¹‰æ•´ä¸ªæµç¨‹éœ€è¦å®Œæˆå“ªäº›é˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéœ€è¦åšä»€ä¹ˆã€‚ Stages é˜¶æ®µï¼š å®šä¹‰äº†æ•´ä¸ªpipelineséœ€è¦åšå“ªäº›äº‹ï¼Œè¿™äº›äº‹éœ€è¦é¡ºåºæ‰§è¡Œã€‚ ä¾‹å¦‚ï¼šå…ˆä¸‹è½½ä¾èµ–ï¼Œç„¶åç¼–è¯‘ä»£ç ï¼Œå†æ¨é€ç¼–è¯‘åçš„ä»£ç ï¼Œæœ€åå‘ä¸€ä¸ªci/cdæˆåŠŸçš„é€šçŸ¥ Jobs ä½œä¸šï¼š æ¯ä¸ªé˜¶æ®µéœ€è¦å®Œæˆçš„æ“ä½œï¼Œä¾‹å¦‚ï¼šä½¿ç”¨æŸä¸ªphpé•œåƒï¼Œæ‰§è¡Œcomposer install å‘½ä»¤ä¸‹è½½ä¾èµ–ã€‚ ä»¥ä¸‹ä¸ºå®˜æ–¹ç¤ºä¾‹ä¸ºä¾‹ï¼š stages: # é˜¶æ®µ - build - test - deploy image: alpine # ä½œä¸š build_a: stage: build script: - echo &quot;This job builds something.&quot; build_b: stage: build script: - echo &quot;This job builds something else.&quot; test_a: stage: test script: - echo &quot;This job tests something. It will only run when all jobs in the&quot; - echo &quot;build stage are complete.&quot; test_b: stage: test script: - echo &quot;This job tests something else. It will only run when all jobs in the&quot; - echo &quot;build stage are complete too. It will start at about the same time as test_a.&quot; deploy_a: stage: deploy script: - echo &quot;This job deploys something. It will only run when all jobs in the&quot; - echo &quot;test stage complete.&quot; deploy_b: stage: deploy script: - echo &quot;This job deploys something else. It will only run when all jobs in the&quot; - echo &quot;test stage complete. It will start at about the same time as deploy_a.&quot; å¯¹äºæ›´å¤šå†…å®¹ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ Jobs ä½œä¸š ä½œä¸šæ‰æ˜¯æµæ°´çº¿æ¯ä¸ªé˜¶æ®µå®é™…æ‰§è¡Œçš„å†…å®¹ï¼Œæ¯ä¸ªä½œä¸šéƒ½åº”è¯¥å®šä¹‰åœ¨é¡¶çº§ï¼Œå¹¶ä¸”æ‹¥æœ‰è‡³å°‘ä¸€ä¸ªscriptã€‚ æ‚¨å¯ä»¥ç†è§£ä¸ºæµæ°´çº¿çš„å·¥äºº ä»¥å®˜æ–¹æ–‡æ¡£ä¸ºä¾‹ï¼š job1: # ä½œä¸šçš„åç§° script: &quot;execute-script-for-job1&quot; # ä½œä¸šæ‰§è¡Œçš„è„šæœ¬ job2: # ä½œä¸šçš„åç§° script: &quot;execute-script-for-job2&quot; # ä½œä¸šæ‰§è¡Œçš„è„šæœ¬ ä½œä¸šå®šä¹‰çš„æ•°é‡ä¸å—é™åˆ¶ï¼Œæ¯ä¸ªä½œä¸šéƒ½æ˜¯ç‹¬ç«‹çš„å•ç‹¬è¿è¡Œã€‚ âš ï¸ æ¯ä¸ªä½œä¸šéƒ½æ˜¯å•ç‹¬ï¼Œç‹¬ç«‹è¿è¡Œã€‚æ‰€ä»¥ï¼Œå³ä½¿åœ¨åŒä¸€ä¸ªæµæ°´çº¿ä¸­ ä¹Ÿå°±æ˜¯åœ¨ä¸€æ¬¡ci/cdä¸­ã€‚æ¯ä¸ªä½œä¸šè¿è¡Œçš„runneréƒ½å¯èƒ½æ˜¯ä¸åŒçš„ã€‚ ä¾‹å¦‚ï¼šä½ åœ¨runner1 ä¸Šæ‹‰å–äº†ä¾èµ–ï¼Œä½ åœ¨runner2ä¸Šç¼–è¯‘äº†ä»£ç ï¼Œä½ åœ¨runner3ä¸Šå‘é€äº†ä¸€ä¸ªé€šçŸ¥ã€‚ é‚£ä¹ˆï¼Œå¦‚æœåœ¨deployæ—¶æƒ³ä½¿ç”¨ä¸Šä¸€ä¸ªé˜¶æ®µç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶è¯¥å¦‚ä½•æ“ä½œå‘¢ï¼Ÿ Caching / Artifacts ç¼“å­˜å’Œåˆ¶å“ Artifacts åˆ¶å“ï¼Œå¯ä»¥ç†è§£ä¸ºä½œä¸šäº§å‡ºçš„å†…å®¹ï¼ˆä¸Šä¸ªæµæ°´çº¿å·¥äººäº§å‡ºçš„å†…å®¹ï¼‰ ç®€å•ä»¥ä¸‹é¢è¿™ä¸ªä¸ºä¾‹ï¼š stages: - install - build - deploy install-online: stage: install image: tool/yarn:v1 script: - yarn install - yarn build:prod # å°†yarn build æ‰“åŒ…å‡ºæ¥çš„dist ä½œä¸ºåˆ¶å“ï¼Œä¼ åˆ°ä¸‹ä¸€ä¸ªjob artifacts: paths: - dist/ # é»˜è®¤æƒ…å†µä¸‹ï¼Œåé¢é˜¶æ®µçš„ä½œä¸šä¼šè‡ªåŠ¨ä¸‹è½½ç”±å‰é¢é˜¶æ®µçš„ä½œä¸šåˆ›å»ºçš„æ‰€æœ‰åˆ¶å“ã€‚ build-online-image: stage: build image: tool/docker:latest only: - master script: - docker build -t $ONLIE_IMAGE_NAME . - docker push $ONLIE_IMAGE_NAME - docker tag $ONLIE_IMAGE_NAME $IMAGE - docker push $IMAGE deploy-online: stage: deploy image: kubematrix/cli:v1 # å¦‚æœæ‚¨ä¸éœ€è¦ä¾èµ–ä»»ä½•çš„åˆ¶å“ï¼Œä½ å¯ä»¥ä½¿ç”¨dependencies: [] dependencies: [] only: - master script: - matrix workloads deploy åœ¨installæ—¶å®‰è£…ä¾èµ–å¹¶æ‰“åŒ…å‡ºä¸€ä¸ªdistæ–‡ä»¶å¤¹ï¼Œä½¿ç”¨artifactså°†è¿™ä¸ªæ–‡ä»¶å¤¹æ‰“åŒ…å‡ºæ¥ã€‚ åœ¨installæ‰§è¡Œå®Œæˆåï¼Œbuildé˜¶æ®µæ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ä¹‹å‰çš„artifacts ä¹Ÿå°±æ˜¯distæ–‡ä»¶å¤¹ï¼Œå®Œæˆäº†å°†ä¸Šä¸ªé˜¶æ®µç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶å¸¦åˆ°ä¸‹ä¸ªé˜¶æ®µçš„æ“ä½œã€‚ dependencies ä¾èµ– å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œ Cache ç¼“å­˜ ä»¥phpä¸ºä¾‹: # # https://gitlab.com/gitlab-org/gitlab/-/tree/master/lib/gitlab/ci/templates/PHP.gitlab-ci.yml # image: php:7.2 # Cache libraries in between jobs cache: key: $CI_COMMIT_REF_SLUG paths: - vendor/ before_script: # Install and run Composer - curl --show-error --silent &quot;https://getcomposer.org/installer&quot; | php - php composer.phar install test: script: - vendor/bin/phpunit --configuration phpunit.xml --coverage-text --colors=never ä»¥$CI_COMMIT_REF_SLUG(é¢„å®šä¹‰å˜é‡ï¼Œè¿™é‡Œæ˜¯æŒ‡åˆ†æ”¯çš„åç§°)ä¸ºkeyï¼Œ å°†vendor/ç›®å½•ç¼“å­˜ä¸‹æ¥ã€‚ ç¼“å­˜ä¸‹æ¥ ä»¥åçš„æ¯ä¸€æ¬¡ä½œä¸šï¼Œéƒ½ä¼šä¸‹è½½ç¼“å­˜ï¼Œè¿™æ ·ä¼šåŠ é€Ÿcomposer install çš„é€Ÿåº¦ âš ï¸éœ€è¦æ³¨æ„çš„ç‚¹ï¼š cache:key å¦‚æœä¸æŒ‡å®škeyï¼Œé‚£ä¹ˆé»˜è®¤åŒä¸€ä¸ªé¡¹ç›®çš„æ‰€æœ‰buildå…±äº«è¿™ä¸ªç¼“å­˜ã€‚å…³äºcache:keyçš„å„ç§åœºæ™¯ä½¿ç”¨ï¼Œå¯å‚è€ƒï¼šCaching in GitLab CI/CD | GitLab é»˜è®¤cacheä½¿ç”¨æœ¬åœ°ç£ç›˜ä¿å­˜ï¼Œä½†è¿™æ ·ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ã€‚å¦‚æœæ¯æ¬¡jobè¿è¡Œéƒ½åœ¨ä¸åŒçš„runnerä¸Šï¼Œé‚£ä¹ˆç¼“å­˜æ˜¯ä¸å¯ä»¥å…±äº«çš„ã€‚è¿™æ—¶å€™å°±éœ€è¦å¼•å…¥ä¸€ä¸ªåˆ†å¸ƒå¼å­˜å‚¨è¿™ä¸ªç¼“å­˜æ–‡ä»¶ã€‚ é…ç½®é˜¿é‡Œäº‘OSSå­˜å‚¨cacheæ–‡ä»¶ Advanced configuration | GitLab ä¸ºäº†ç»Ÿä¸€ç¼“å­˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨OSS é¦–å…ˆè¿›å…¥gitlab-runnerå¯¹åº”çš„ä¸»æœºï¼Œgitlab-runner list æŸ¥çœ‹é…ç½®æ–‡ä»¶å­˜æ”¾çš„ä½ç½® /etc/gitlab-runner/config.toml [[runners]] name = &quot;cloud5&quot; url = &quot;https://gitlab.xxx.cn/&quot; token = &quot;token&quot; executor = &quot;docker&quot; [runners.custom_build_dir] [runners.cache] Type = &quot;s3&quot; Shared = true Path = &quot;xxx&quot; [runners.cache.s3] ServerAddress = &quot;oss-cn-hangzhou.aliyuncs.com&quot; AccessKey = &quot;key&quot; SecretKey = &quot;sec&quot; BucketName = &quot;gitlab-runner-cached&quot; BucketLocation = &quot;oss-cn-hangzhou&quot; [runners.docker] tls_verify = false image = &quot;ruby:2.6&quot; privileged = false disable_entrypoint_overwrite = false oom_kill_disable = false disable_cache = false volumes = [&quot;/var/run/docker.sock:/var/run/docker.sock&quot;, &quot;/root/.docker/:/root/.docker/&quot;, &quot;/data/gitlab-runner/cache:/cache&quot;, &quot;/data/gitlab-runner/npm-cache:/root/.npm&quot;, &quot;/data/gitlab-runner/composer-cache:/root/.composer&quot;] shm_size = 0 pull_policy = &quot;if-not-present&quot; ä¸»è¦å†…å®¹ä¸ºä»¥ä¸‹ï¼š [runners.cache] Type = &quot;s3&quot; # ç¼“å­˜ç±»å‹ Shared = true # ç¼“å­˜åœ¨å¤šä¸ªrunnerä¹‹é—´å…±äº« Path = &quot;xxx&quot; # ç¼“å­˜è·¯å¾„å‰ç¼€ï¼Œå¦‚æœä¸€ä¸ªgitlab-runneråœ¨å¤šä¸ªgitlabä¸­æ³¨å†Œï¼Œå¯ä»¥ä½¿ç”¨å‰ç¼€çš„æ–¹å¼åšåŒºåˆ† [runners.cache.s3] ServerAddress = &quot;oss-cn-hangzhou.aliyuncs.com&quot; # ossåœ°å€ AccessKey = &quot;key&quot; # key SecretKey = &quot;sec&quot; # secret BucketName = &quot;gitlab-runner-cached&quot; # bucketName BucketLocation = &quot;oss-cn-hangzhou&quot; # BucketLocation ä»¥æ­¤ç±»æ¨ï¼Œä½ éœ€è¦åœ¨æ‰€æœ‰çš„gitlab-runnerä¸­é…ç½®æ­¤ç¼“å­˜ï¼Œè¿™æ ·æ‰€æœ‰çš„ç¼“å­˜éƒ½ä¼šè¢«ä¸Šä¼ åˆ°é˜¿é‡Œäº‘çš„OSSä¸­ï¼Œæ— è®ºä½ çš„jobè¿è¡Œåœ¨å“ªä¸ªrunnerä¸­ã€‚ ç¤ºä¾‹ï¼š ä»¥ä¸€ä¸ªå‰ç«¯é¡¹ç›®ä¸ºä¾‹ï¼š # å®šä¹‰ variables: ONLIE_IMAGE_NAME: registry.cn-hangzhou.aliyuncs.com/$CI_PROJECT_NAME:$CI_COMMIT_SHORT_SHA stages: - preInstall - install - build - deploy build-image: stage: build image: docker only: - test script: - docker build -t $IMAGE . - docker push $IMAGE # ---------------------------------- master ---------------------------------- # åªæœ‰å½“package.jsonå˜åŒ–æ—¶æ‰ä¼šé‡æ–°install preInstall-job: stage: preInstall image: yarn:v1 cache: key: $CI_COMMIT_REF_SLUG paths: - node_modules/ - yarn.lock # åªéœ€è¦æ¨é€ç¼“å­˜ï¼Œä¸éœ€è¦æ‹‰å–ç¼“å­˜ policy: push only: refs: - master changes: - package.json script: - yarn install install-online: stage: install image: yarn:v1 cache: key: $CI_COMMIT_REF_SLUG paths: - node_modules/ - yarn.lock # åªéœ€è¦æ‹‰å–ç¼“å­˜ï¼Œä¸éœ€è¦æ¨é€ç¼“å­˜ policy: pull only: - master script: # å½“ç¼“å­˜å­˜åœ¨æ—¶ä¸éœ€è¦install - if [ ! -d &quot;./node_modules/&quot; ];then yarn install; else ls -alh; fi - yarn build:prod # æ‰“åŒ…åˆ¶å“ç»™åé¢çš„job artifacts: paths: - dist/ build-online-image: stage: build # ä½¿ç”¨dockeré•œåƒ image: docker:latest # åªåœ¨masteråˆ†æ”¯å˜åŠ¨æ—¶è¿è¡Œè¿™ä¸ªjob only: - master script: - docker build -t $ONLIE_IMAGE_NAME . # æ„å»ºé•œåƒ - docker push $ONLIE_IMAGE_NAME # æ¨é€é•œåƒ deploy-online: stage: deploy # ä½¿ç”¨kubematrix-clié•œåƒ image: kubematrix/cli:v1 # ä¾èµ–ä¸ºç©ºï¼Œè¡¨ç¤ºä¸éœ€è¦ä»»ä½•çš„ä¾èµ– dependencies: [] only: - master script: - matrix workloads deploy ç¤ºä¾‹è®²è§£ GitLab CI/CD variables | GitLab å˜é‡ å¯ä»¥åœ¨æ–‡æ¡£Predefined variables reference | GitLab ä¸­æŸ¥çœ‹é¢„å®šä¹‰çš„å˜é‡ é¦–å…ˆå®šä¹‰å˜é‡ ONLIE_IMAGE_NAME ä»¥ä¾›ä½¿ç”¨ å®šä¹‰stages æµæ°´çº¿é˜¶æ®µ å®šä¹‰äº†4ä¸ªé˜¶æ®µï¼ŒpreInstallï¼Œinstallï¼Œbuildï¼Œdeployï¼Œä¸‹é¢çš„jobå°†æŒ‰ç…§å…³è”çš„stagé¡ºåºæ‰§è¡Œ å®šä¹‰job stag å®šä¹‰äº†jobå¯¹åº”çš„é˜¶æ®µã€‚ imageï¼šå®šä¹‰äº†æ‰§è¡Œè„šæœ¬æ‰€ä½¿ç”¨çš„dockeré•œåƒã€‚ only ï¼š å®šä¹‰äº†jobåªåœ¨æŸäº›æƒ…å†µä¸‹æ‰§è¡Œã€‚é»˜è®¤ä¸ºonly.refsè¾“å…¥åˆ†æ”¯åï¼Œæˆ–ä¸åˆ†æ”¯ç›¸åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚only.changes æ£€æµ‹åªåœ¨æŸäº›æ–‡ä»¶å˜åŠ¨æ—¶è¿è¡Œã€‚ cache ï¼š å®šä¹‰äº†æ”¹jobä½¿ç”¨ç¼“å­˜ï¼Œcache.policy ç¼“å­˜è§„åˆ™ï¼Œé»˜è®¤ä¸ºpull-pushå¼€å§‹jobå‰æ‹‰å–ç¼“å­˜,jobæˆåŠŸåæ¨é€ç¼“å­˜ã€‚ å¯ä¿®æ”¹ä¸ºpushåªæ¨é€ï¼Œä¸æ‹‰å–ã€‚pullåªæ‹‰å–ï¼Œä¸æ¨é€ artifactsï¼š å®šä¹‰äº†éœ€è¦æ‰“åŒ…çš„åˆ¶å“ï¼Œç»™åé¢çš„jobä½¿ç”¨ dependencies : éœ€è¦çš„ä¾èµ–ï¼Œå¦‚æœä¸Šé¢çš„jobæœ‰artifacts ä¼šé»˜è®¤ä¸‹è½½ï¼Œå¦‚æœä¸éœ€è¦artifacts å¯å°†è¿™ä¸ªå±æ€§å®šä¹‰ä¸ºç©ºæ•°ç»„ ","link":"https://blog.marun.run/gitlab-cicd/"},{"title":"androidé€†å‘ 360åŠ å›ºapkï¼Œfrida Hook javaä»£ç ","content":"å‚è€ƒæ–‡ç« ï¼š https://www.52pojie.cn/forum.php?mod=viewthread&amp;tid=1287307 ä¹¦æ¥ä¸Šæ–‡ï¼Œè¿™æ¬¡æˆ‘ä¼šå°è¯•apkçš„é€†å‘ï¼Œæ‰¾åˆ°appä¸èƒ½æŠ“åŒ…çš„åŸå›  å¦‚å›¾æ‰€ç¤ºï¼Œè¿™ä¸ªappè¢«360åŠ å›ºäº†ï¼Œå‡ ç»ç™¾åº¦ï¼ŒæŒ‰ç…§å¼€å¤´é‚£ç¯‡æ–‡ç« çš„å‚è€ƒï¼Œæˆ‘ä»¬å¾—åˆ°äº†dexæ–‡ä»¶ å°†å¤šä¸ªdexæ–‡ä»¶ ç§»åŠ¨åˆ°ç”µè„‘ä¸Š ç”±äºæœ‰å¤šä¸ªdexæ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åˆå¹¶æŸ¥çœ‹ä»£ç  jadxå·¥å…·ï¼š https://github.com/skylot/jadx/ å…·ä½“ä»£ç å¦‚ä¸‹ import os, sys # python3.7 merge_dex.py ./file/ livedex if __name__ == &quot;__main__&quot;: if len(sys.argv) &lt; 3 : print(&quot;start error&quot;) sys.exit() print(sys.argv[1], sys.argv[2]) path = sys.argv[1] #æ–‡ä»¶å¤¹ç›®å½• files= os.listdir(path) #å¾—åˆ°æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åç§° s = [] for file in files: #éå†æ–‡ä»¶å¤¹ if file.find(&quot;dex&quot;) &gt; 0: ## æŸ¥æ‰¾dex æ–‡ä»¶ sh = 'jadx.bat -j 1 -r -d ' + sys.argv[2] + &quot; &quot; + path + file print(sh) os.system(sh) æœ€ç»ˆç»“æœå°±æ˜¯è¿™æ ·äº†ï¼Œå…·ä½“ä»£ç å°±ä¸æ”¾äº†ã€‚ ç»è¿‡æŸ¥çœ‹æºç ï¼Œå‘ç°æ˜¯okHttpè®¾ç½®äº†no_proxy åªéœ€è¦å°†è¿™ä¸€éƒ¨åˆ†ä»£ç hookæ‰å°±okäº†ã€‚ æˆ‘ä½¿ç”¨çš„frida ï¼šhttps://github.com/frida/frida ç”µè„‘ä½¿ç”¨pip install // ç”µè„‘å®‰è£…frida pip install frida-tools # CLI tools pip install frida # Python bindings // å°†frida-serveræ¨åˆ°æ‰‹æœº adb.exe push .\\frida-server-14.0.7-android-arm64 /data/local/tmp/frida-server // è¿æ¥åˆ°æ‰‹æœº adb shell cd /data/local/tmp // åˆ‡åˆ°rootç”¨æˆ· su // ä¿®æ”¹æƒé™ chmod 777 frida-server // æ‰§è¡Œ ./frida-server ä¸Šé¢å°±å°†æ‰‹æœºçš„frida-serverå¼€å¯äº†ï¼Œç„¶ååœ¨ç”µè„‘ä¸Šè¯•è¯•æ˜¯å¦å¯ä»¥æˆåŠŸè¿æ¥ frida-ps.exe -U å¦‚æœæœ‰æ˜¾ç¤ºæ‰‹æœºç›¸å…³è¿›ç¨‹å°±ok å°†è‡ªå·±ç¼–å†™çš„jsä»£ç æ¨åˆ°æ‰‹æœº è¿›è¡Œ hook frida -U --no-pause -f com.showstartfans.activity -l .\\showstart.js showstart.js ä»£ç : Java.perform( function () { var application = Java.use(&quot;android.app.Application&quot;); application.attach.overload('android.content.Context').implementation = function(context) { var result = this.attach(context); // å…ˆæ‰§è¡ŒåŸæ¥çš„attachæ–¹æ³• var classloader = context.getClassLoader(); Java.classFactory.loader = classloader; var Hook_class = Java.classFactory.use(&quot;com.taihebase.activity.utils.SecurityUtil&quot;); console.log(&quot;Hook_class: &quot; + Hook_class); Hook_class.getNeedCapturePacket.implementation = function(){ return true; } return result; } } ) fridaå…³äºjavaçš„å®˜æ–¹æ–‡æ¡£: https://frida.re/docs/javascript-api/#java è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨fiddlerå®‰å¿ƒçš„æŠ“æ¥å£äº† æ•…æŠ€é‡æ–½~ åˆå¯ä»¥æµç•…çš„ä¸‹å•è´­ç¥¨äº†ã€‚ ","link":"https://blog.marun.run/android-ni-xiang-360-jia-gu-apkfrida-hook-java-dai-ma/"},{"title":"fiddler-å®æˆ˜ ","content":"å‰è¨€ï¼š å‰æ®µæ—¶é—´çœ‹äº†ä¸€æ¡£Bç«™çš„ç»¼è‰ºï¼šã€Šè¯´å”±æ–°ä¸–ä»£ã€‹ï¼Œæœ€è¿‘èŠ‚ç›®é‡Œé¢çš„é€‰æ‰‹å¼€å§‹å·¡æ¼”ã€‚æƒ³ä¹°ç¥¨å»çœ‹çœ‹çš„ï¼Œåœ¨ç§€åŠ¨ä¸Šæ²¡ä¹°åˆ°ç¥¨ï¼Œå¾ˆæ°”ã€‚soï¼Œæƒ³æƒ³åŠæ³•å§ï¼Œäºæ˜¯æœ‰äº†ä»¥ä¸‹è®°å½•ã€‚ ä¸€ï¼Œå°è¯•APPæŠ“åŒ…çœ‹çœ‹ æŠ“åŒ…å·¥å…·ï¼šFiddler å…·ä½“é…ç½®ä¸å†èµ˜è¿°ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šæ–‡ç« éƒ½æœ‰è®² Appé…ç½®wifiä»£ç†8888 å¾ˆå¯æƒœï¼ŒAppå¹¶æ²¡æœ‰æˆåŠŸï¼ŒåªæŠ“åˆ°å‡ å¼ å›¾ç‰‡çš„ğŸ˜­ äºŒï¼Œå°è¯•wapç«¯ æ—¢ç„¶Appç«¯ä¸å¯ä»¥çš„è¯ï¼Œé‚£å°±å°è¯•ä¸€ä¸‹wapç«¯å§ã€‚ å‘ï¼Œè¿™é‡Œæ˜¾ç¤ºåªèƒ½å»appè´­ä¹°ï¼Œå¯æ¶ğŸ˜¤ï¼Œå³é”®æ£€æŸ¥ä¸€ä¸‹ã€‚ è¿™é‡ŒåŠ å…¥äº†ä¸€ä¸ªidï¼Œæ‰’ä¸‹jsï¼Œdetail.js è¿™é‡Œåˆ¤æ–­äº†activity.type == 6 ï¼Œçœ‹ä¸‹æ¥å£ï¼Œå“ªé‡Œæœ‰type : 6çš„ å‘ï¼Œä¸å‡ºæ„å¤–å°±æ˜¯è¿™é‡Œäº†ï¼Œæˆ‘ä»¬ä½¿ç”¨fillder æ‹¦æˆªresponse ï¼Œä¿®æ”¹è¿™ä¸ªtype ç¬¬ä¸€æ­¥ï¼ŒåŒå‡»è¿™ç©æ„å„¿ï¼Œå¼€å¯responseæ‹¦æˆªåŠŸèƒ½ ï¼ˆæ³¨æ„è¿™é‡Œä¼šæ‹¦æˆªæ‰€æœ‰çš„responseï¼Œåœ¨æ²¡æœ‰æŠ“åˆ°ä½ æƒ³è¦çš„æ¥å£æ—¶ï¼Œå…ˆç‚¹ä¸Šé¢çš„go æ”¾è¡Œæ‰€æœ‰çš„è¯·æ±‚ï¼Œç›´åˆ°ä½ æƒ³è¦çš„æ¥å£å‡ºç°ï¼‰ ç¬¬äºŒæ­¥ï¼Œæœåˆ°æƒ³è¦ä¿®æ”¹çš„å€¼ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯&quot;type&quot;:6 æ”¹ä¸ºtype:1 ç¬¬ä¸‰æ­¥ï¼Œä¿®æ”¹æˆåŠŸåç‚¹å‡»è¿™ä¸ªrun to xxxxçš„ç»¿è‰²æŒ‰é’®ï¼Œå†æŠŠç¬¬ä¸€æ­¥è¿™é‡Œè¿˜åŸå°±è¡Œ å¥½äº†ï¼Œæ¥çœ‹çœ‹ç°åœ¨çš„é¡µé¢ ä»åªèƒ½appè´­ä¹°ï¼Œå˜æˆäº†ç«‹å³è´­ç¥¨ niceï¼Œå…„å¼Ÿã€‚ç¬¬ä¸€æ­¥å®Œæˆäº† æˆ‘ä»¬ç‚¹å‡»ç«‹å³è´­ç¥¨ å¯æƒœè¿™é‡Œæ˜¾ç¤ºå³å°†å¼€å”®ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªåœ°æ–¹çš„æ¥å£ è¿™é‡Œæˆ‘ä»¬æ•…æŠ€é‡æ–½ï¼ŒæŠŠè¿™é‡Œçš„0 éƒ½æ”¹æˆ10ï¼Œ æ³¨æ„è¿™é‡Œçš„salesStatusä¹Ÿéœ€è¦æ”¹æˆ1 å‘ï¼Œè¿™é‡Œå°±å¯ä»¥ç›´æ¥ç‚¹ç«‹å³è´­ä¹°äº†,ç‚¹è¿›å»å°±ä¸‹å•é¡µäº†ã€‚ è¿™é‡Œçš„å·²å”®ç½„å…¶å®ä¹Ÿå¯ä»¥æ”¹ï¼ŒåŒæ ·é€šè¿‡fiddler æ”¹æ¥å£ï¼Œæˆ‘å°±ä¸å†æ¼”ç¤ºäº†ã€‚ by the way , è¿™é‡Œå¦‚æœç›´æ¥è¿›æ¥çš„è¯ï¼Œå…¶å®ç›´æ¥é€šè¿‡urlä¸‹æ¬¡å†è¿›æ¥äº†ï¼Œå°±ä¸ç”¨å‰é¢çš„å‡ æ­¥æ“ä½œäº†ï¼Œé“¾æ¥æ”¾ä¸‹é¢ https://wap.showstart.com/pages/order/activity/confirm/confirm?sequence=123744&amp;ticketId=2d80ca0d806844cba6915518356f76c6&amp;ticketNum=1 ","link":"https://blog.marun.run/fiddler-shi-zhan-yi/"},{"title":"mysqlä¸­ group byæ’åºï¼Œderived_mergeä¼˜åŒ–çš„å‘","content":"ä¸€ä¸ªç®€å•çš„è¡¨ CREATE TABLE `test` ( `id` int(11) NOT NULL AUTO_INCREMENT, `spu_id` int(11) DEFAULT NULL, `price` decimal(10,2) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci; å¤§æ¦‚å†…å®¹ id spu_id price 1 100 200 2 100 100 3 200 400 4 200 200 å¯¹spu_idè¿›è¡Œåˆ†ç»„ï¼ŒæŒ‰priceä»å°åˆ°å¤§æ’åºï¼š SELECT * FROM `test` GROUP BY spu_id ORDER BY price ç›´æ¥ä½¿ç”¨group by æŸ¥å‡ºæ¥çš„æ•°æ®æ˜¯æŒ‰idé¡ºåºåˆ†ç»„çš„ï¼Œå¹¶æœªè¾¾åˆ°é¢„æœŸ å°è¯•ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå…ˆæ’åºå†åˆ†ç»„ SELECT * FROM ( SELECT * FROM `test` ORDER BY price ) AS tmp GROUP BY spu_id æ³¨æ„ï¼šè¿™ä¸ªæ–¹å¼åœ¨ä½ç‰ˆæœ¬ä¸­æœ‰æ•ˆã€‚åœ¨5.7ç‰ˆæœ¬ä¸­å¼•å…¥æ–°ç‰¹æ€§ derived_mergeä¼˜åŒ–è¿‡åæ— æ•ˆäº†ã€‚ å…·ä½“æ— æ•ˆåŸå› æˆ‘ä»¬å¯ä½¿ç”¨explain åˆ†æ EXPLAIN SELECT * FROM ( SELECT * FROM `test` ORDER BY price) AS tmp GROUP BY spu_id; å¦‚å›¾æ‰€ç¤ºï¼š MySQL å°†å­æŸ¥è¯¢ä¼˜åŒ–æˆäº†ä¸€ä¸ªç®€å•æŸ¥è¯¢ï¼Œå­æŸ¥è¯¢ä¸­çš„æ’åºæ— æ•ˆ~ è§£å†³æ–¹æ³•ï¼š å°†derived_merge å…³é—­ SET optimizer_switch='derived_merge=off'; SET GLOBAL optimizer_switch='derived_merge=off'; ä½¿ç”¨ç‰¹æ®Šçš„æŸ¥è¯¢é˜»æ­¢ derived_merge ä¼˜åŒ– å¯ä»¥é€šè¿‡åœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨ä»»ä½•é˜»æ­¢åˆå¹¶çš„æ„é€ æ¥ç¦ç”¨åˆå¹¶ï¼Œå°½ç®¡è¿™äº›æ„é€ å¯¹å®ç°çš„å½±å“ä¸é‚£ä¹ˆæ˜æ˜¾ã€‚é˜²æ­¢åˆå¹¶çš„æ„é€ ä¸æ´¾ç”Ÿè¡¨å’Œè§†å›¾å¼•ç”¨ç›¸åŒï¼š èšåˆå‡½æ•°ï¼ˆSUM()ï¼Œ MIN()ï¼Œ MAX()ï¼Œ COUNT()ï¼Œç­‰ç­‰ï¼‰ DISTINCT GROUP BY HAVING LIMIT UNION è¦ä¹ˆ UNION ALL é€‰æ‹©åˆ—è¡¨ä¸­çš„å­æŸ¥è¯¢ åˆ†é…ç»™ç”¨æˆ·å˜é‡ ä»…å¼•ç”¨æ–‡å­—å€¼ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡æœ‰åŸºç¡€è¡¨ï¼‰ ä»¥ä¸Šå†…å®¹å‚è€ƒæ–‡æ¡£ï¼šmysqlæ–‡æ¡£ é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„é‚£æ¡sqlè¯­å¥ä¿®æ”¹ä¸ºï¼š SELECT * FROM ( SELECT * FROM `test` HAVING 1=1 ORDER BY price ) AS tmp GROUP BY spu_id; ä½¿ç”¨ having æ¥é˜»æ­¢åˆå¹¶ é‚£ä¹ˆå†ç”¨explainçœ‹çœ‹ å¦‚æœ‰é”™è¯¯è¯·æŒ‡æ­£~ è¯·å¤šåŒ…æ¶µ ","link":"https://blog.marun.run/mysql-group-by-pai-xu-derived_merge-you-hua-de-keng/"},{"title":" åœ¨ Hyperf æ¡†æ¶ä¸­ä½¿ç”¨ prometheus + grafana éƒ¨ç½²åŸºæœ¬çš„ç›‘æ§","content":"å‚è€ƒï¼š hyperfåˆ©ç”¨prometheusæ¥å…¥æœåŠ¡ç›‘æ§,ä½¿ç”¨grafanaå®ç°æ•°æ®çš„å®æ—¶ç›‘æ§æ˜¾ç¤º hyperfæ–‡æ¡£ æœ¬æ–‡ç« è®°å½•æœ¬äººçš„ç¬¬ä¸€æ¬¡éƒ¨ç½²æ‰€è¸©çš„å‘ï¼Œæœªæ·±å…¥äº†è§£prometheus å’Œgrafana å¦‚æœ‰ä¸å½“çš„åœ°æ–¹è¯·æŒ‡æ­£ï¼Œè°¢è°¢ï¼ ä¸€. ä½¿ç”¨docker-composeéƒ¨ç½² version: '2' networks: monitor: driver: bridge services: prometheus: image: prom/prometheus container_name: prometheus hostname: prometheus restart: always volumes: # å°†ä½ çš„prometheus.ymlæ–‡ä»¶æ”¾åœ¨å½“å‰æ–‡ä»¶åŒçº§ä¸‹ï¼Œæˆ–è‡ªå®šä¹‰ - ./prometheus.yml:/etc/prometheus/prometheus.yml #- /home/prometheus/node_down.yml:/etc/prometheus/node_down.yml ports: - &quot;9090:9090&quot; networks: monitor: ipv4_address: 172.18.0.3 grafana: image: grafana/grafana container_name: grafana hostname: grafana restart: always volumes: # åˆ›å»º etcç›®å½•ï¼Œdataç›®å½•å­˜å‚¨grafanaçš„æ•°æ® - ./etc:/etc/grafana - ./data:/var/lib/grafana ports: - &quot;3000:3000&quot; networks: monitor: ipv4_address: 172.18.0.4 node-exporter: image: prom/node-exporter container_name: node-exporter hostname: node-exporter restart: always ports: - &quot;9100:9100&quot; networks: monitor: ipv4_address: 172.18.0.2 æ³¨æ„ï¼šä¸ºäº†é¿å…æ¯æ¬¡docker-compose å¯åŠ¨ä¹‹å ipä¼šå‘ç”Ÿå˜åŒ–ï¼Œæˆ‘è¿™é‡Œé…ç½®äº†å›ºå®šIPï¼Œè¯·æ ¹æ®ä¸ªäººå®é™…æƒ…å†µé…ç½®ï¼Œæˆ–å‚é˜…dockerç›¸å…³æ–‡æ¡£ ä½¿ç”¨å‘½ä»¤docker-compose upå¯åŠ¨å®¹å™¨ äºŒ. é¡¹ç›®é…ç½® å› ä¸ºå¯¹ prometheusçš„ä¸äº†è§£ï¼Œæˆ‘ç›´æ¥ä½¿ç”¨hyperfé»˜è®¤é…ç½® å¼•å…¥ç»„ä»¶ composer require hyperf/metric å‘å¸ƒé»˜è®¤é…ç½®æ–‡ä»¶ php bin/hyperf.php vendor:publish hyperf/metric åœ¨config/autoload/dependencies.phpä¸­æ·»åŠ å¯¹åº”çš„Rediså­˜å‚¨ return [ \\Prometheus\\Storage\\Adapter::class =&gt; \\Hyperf\\Metric\\Adapter\\Prometheus\\RedisStorageFactory::class, ]; åœ¨ä¸Šé¢çš„ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œè€å“¥è¯´ä½¿ç”¨swoole_tableæ›´é«˜æ•ˆï¼Œæˆ‘è¿˜ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨ï¼Œæœ‰å…´è¶£çš„è€å“¥å¯ä»¥è‡ªå·±ç ”ç©¶ä¸€ä¸‹ã€‚ å¢åŠ ä¸­é—´ä»¶ åœ¨config/autoload/middlewares.phpæ–‡ä»¶ä¸­å¢åŠ å¯¹åº”çš„ä¸­é—´ä»¶ return [ 'http' =&gt; [ \\Hyperf\\Metric\\Middleware\\MetricMiddleware::class, ], ]; æ·»åŠ  metricsè·¯ç”± Router::get('/metrics', function(){ $registry = Hyperf\\Utils\\ApplicationContext::getContainer()-&gt;get(Prometheus\\CollectorRegistry::class); $renderer = new Prometheus\\RenderTextFormat(); return $renderer-&gt;render($registry-&gt;getMetricFamilySamples()); }); è¿™æ ·å¯¹é¡¹ç›®çš„é…ç½®å°±å®Œæˆäº† ä¸‰. prometheusçš„é…ç½® åœ¨ prometheus.ymlæ–‡ä»¶ä¸­å¢åŠ å¯¹åº”çš„é…ç½® scrape_configs: # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config. - job_name: 'prometheus' # metrics_path defaults to '/metrics' # scheme defaults to 'http'. static_configs: - targets: ['localhost:9090'] - job_name: 'node' # æ³¨æ„è¿™é‡Œçš„IPéœ€è¦å¡«å†™ node-exporter å®¹å™¨çš„ip static_configs: - targets: ['172.18.0.2:9100'] - job_name: 'skeleton' # è¿™é‡Œå¡«å†™çš„æ˜¯å®¿ä¸»æœºçš„ip static_configs: - targets: ['10.0.75.1:9502'] é…ç½®å®Œæˆä¹‹åï¼Œå†æ¬¡ dokcer-compose up è®¿é—® http://localhost:9090 æŸ¥çœ‹ prometheus å¦‚å›¾æ‰€ç¤ºï¼Œnode å’Œ skeleton éƒ½å·²å¯åŠ¨ å››. Grafana é…ç½® ä¸Šé¢éƒ½é…ç½®å®Œäº†ï¼Œå¼€å§‹é…ç½® Grafana æ‰“å¼€ http://localhost:3000 é»˜è®¤å¯†ç æ˜¯: admin/admin æ–°å»ºdatasource å·¦ä¾§è¾¹æ  add datasources é€‰æ‹©Prometheus é…ç½® datasource å¡«å†™å®¹å™¨çš„IP:ç«¯å£ å¯¼å…¥hyperfå®˜æ–¹çš„JSONæ–‡ä»¶ å¯¼å…¥ä¹‹åéœ€è¦å°†é»˜è®¤çš„ app_nameæ”¹æˆä½ è‡ªå·±çš„ å¦‚ï¼šadmin-api å°±éœ€è¦å¡«å†™admin_api æ”¹æˆä¸‹åˆ’çº¿å½¢å¼ æŸ¥çœ‹ç›‘æ§ åœ¨Homeä¸­ä½ å°±å¯ä»¥çœ‹åˆ°äº† ç‚¹è¿›å»æŸ¥çœ‹ åˆ°æ­¤ç»“æŸï¼Œå°ç™½ç¬¬ä¸€æ¬¡é…ç½®ç›‘æ§ï¼Œè¿˜æœ‰å¾ˆå¤šä¸œè¥¿æ²¡å¼„æ¸…æ¥š ","link":"https://blog.marun.run/hyperf-grafana/"}]}