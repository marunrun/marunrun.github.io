{"posts":[{"title":"gitlab-ci/cd","content":"ç®€å•ä»‹ç»gitlab-ci/cdçš„ä½¿ç”¨ å®˜æ–¹æ–‡æ¡£ï¼š GitLab CI/CD æ²¡æœ‰æ¯”å®˜æ–¹æ–‡æ¡£æ›´å¥½ä¸è¿‡çš„æ•™ç¨‹äº†ï¼ gitlab-ciå¦‚ä½•è¿è¡Œï¼Ÿ gitlab-ciå¹¶ä¸æ˜¯å¹³ç™½æ— æ•…è¿è¡Œèµ·æ¥çš„ï¼Œä¾æ‰˜äºä¸€ä¸ªå«åšGitLab Runner çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬é…ç½®çš„gitlab-ci æ‰ä¼šé¡ºåˆ©çš„è¿è¡Œã€‚ å¦‚æœä½ å¯¹Install GitLab Runner æ„Ÿå…´è¶£ï¼Œå¯ä»¥å‚çœ‹æ–‡æ¡£ï¼Œgitlab-runneræ˜¯å¦‚ä½•å®‰è£…çš„ã€‚ ci/cdçš„è¿è¡Œ è‡³å°‘éœ€è¦ä¸€ä¸ªgitlab-runnerã€‚å½“ç„¶ä¹Ÿå¯ä»¥é…ç½®å¤šä¸ªï¼Œæ¯”å¦‚æ‚¨å¯ä»¥åœ¨macosç³»ç»Ÿä¸Šå®‰è£…gitlab-runnerå¹¶æ³¨å†Œåˆ°gitlabä¸­ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥å°†ç±»ä¼¼iosæ‰“åŒ…çš„è¿‡ç¨‹æ”¾åˆ°è¿™ä¸ªrunnerä¸Šäº†ã€‚ä»¥æ­¤ç±»æ¨ï¼Œå¦‚æœæ‚¨æœ‰ç‰¹æ®Šè¦æ±‚çš„ci/cdï¼Œå¯ä»¥æŒ‡å®šç‰¹æ®Šçš„runnerã€‚ ci/cdè¿è¡Œè¿‡ç¨‹ï¼š gitlabæŒ‰ç…§æ‚¨é¡¹ç›®ä¸­çš„çš„gitlab-ci.yamlé…ç½®ï¼Œåˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªjob,ç„¶åç­‰å¾…gitlab-runnerè¿è¡Œè¿™äº›jobã€‚ å¤§æ¦‚çš„è¿‡ç¨‹ç±»ä¼¼äºï¼š é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œå™¨ ä¹Ÿå°±æ˜¯æ‰§è¡Œå‘½ä»¤ç­‰æ“ä½œçš„ç¯å¢ƒï¼Œéœ€è¦gitlab-runnerä¸­é…ç½®ã€‚ä¾‹å¦‚shellä¹Ÿå°±æ˜¯åœ¨gitlab-runnerä¸»æœºä¸Šè¿è¡Œã€‚dockerå°±æ˜¯æ‹‰å–æŸä¸ªé•œåƒï¼Œåœ¨é•œåƒä¸­æ‰§è¡Œå‘½ä»¤ã€‚ ä¸‹æ–‡çš„runnerçš„æ‰§è¡Œå™¨å‡ä¸ºdocker æ‹‰å–æºç  é‡å»ºç¼“å­˜ å¦‚æœå½“å‰jobæˆ–è€…æµæ°´çº¿æœ‰é…ç½®ç¼“å­˜ï¼Œä¼šæ‹‰å–ç¼“å­˜ã€‚ï¼ˆä¸‹æ–‡è¯¦ç»†è¯´ï¼‰ ä¸‹è½½artifacts å¦‚æœå½“å‰jobçš„ä¸Šæ¸¸æœ‰é…ç½®artifactsï¼Œä¼šä¸‹è½½artifactsï¼ˆä¸‹æ–‡è¯¦ç»†è¯´ï¼‰ æ‰§è¡Œå‘½ä»¤ æ‰§è¡Œæ‚¨çš„scripts CI/CD pipelines æµæ°´çº¿ é¡¾åæ€ä¹‰ï¼Œæµæ°´çº¿ ï¼Œä¹Ÿå°±æ˜¯å®šä¹‰æ•´ä¸ªæµç¨‹éœ€è¦å®Œæˆå“ªäº›é˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéœ€è¦åšä»€ä¹ˆã€‚ Stages é˜¶æ®µï¼š å®šä¹‰äº†æ•´ä¸ªpipelineséœ€è¦åšå“ªäº›äº‹ï¼Œè¿™äº›äº‹éœ€è¦é¡ºåºæ‰§è¡Œã€‚ ä¾‹å¦‚ï¼šå…ˆä¸‹è½½ä¾èµ–ï¼Œç„¶åç¼–è¯‘ä»£ç ï¼Œå†æ¨é€ç¼–è¯‘åçš„ä»£ç ï¼Œæœ€åå‘ä¸€ä¸ªci/cdæˆåŠŸçš„é€šçŸ¥ Jobs ä½œä¸šï¼š æ¯ä¸ªé˜¶æ®µéœ€è¦å®Œæˆçš„æ“ä½œï¼Œä¾‹å¦‚ï¼šä½¿ç”¨æŸä¸ªphpé•œåƒï¼Œæ‰§è¡Œcomposer install å‘½ä»¤ä¸‹è½½ä¾èµ–ã€‚ ä»¥ä¸‹ä¸ºå®˜æ–¹ç¤ºä¾‹ä¸ºä¾‹ï¼š stages: # é˜¶æ®µ - build - test - deploy image: alpine # ä½œä¸š build_a: stage: build script: - echo &quot;This job builds something.&quot; build_b: stage: build script: - echo &quot;This job builds something else.&quot; test_a: stage: test script: - echo &quot;This job tests something. It will only run when all jobs in the&quot; - echo &quot;build stage are complete.&quot; test_b: stage: test script: - echo &quot;This job tests something else. It will only run when all jobs in the&quot; - echo &quot;build stage are complete too. It will start at about the same time as test_a.&quot; deploy_a: stage: deploy script: - echo &quot;This job deploys something. It will only run when all jobs in the&quot; - echo &quot;test stage complete.&quot; deploy_b: stage: deploy script: - echo &quot;This job deploys something else. It will only run when all jobs in the&quot; - echo &quot;test stage complete. It will start at about the same time as deploy_a.&quot; å¯¹äºæ›´å¤šå†…å®¹ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ Jobs ä½œä¸š ä½œä¸šæ‰æ˜¯æµæ°´çº¿æ¯ä¸ªé˜¶æ®µå®é™…æ‰§è¡Œçš„å†…å®¹ï¼Œæ¯ä¸ªä½œä¸šéƒ½åº”è¯¥å®šä¹‰åœ¨é¡¶çº§ï¼Œå¹¶ä¸”æ‹¥æœ‰è‡³å°‘ä¸€ä¸ªscriptã€‚ æ‚¨å¯ä»¥ç†è§£ä¸ºæµæ°´çº¿çš„å·¥äºº ä»¥å®˜æ–¹æ–‡æ¡£ä¸ºä¾‹ï¼š job1: # ä½œä¸šçš„åç§° script: &quot;execute-script-for-job1&quot; # ä½œä¸šæ‰§è¡Œçš„è„šæœ¬ job2: # ä½œä¸šçš„åç§° script: &quot;execute-script-for-job2&quot; # ä½œä¸šæ‰§è¡Œçš„è„šæœ¬ ä½œä¸šå®šä¹‰çš„æ•°é‡ä¸å—é™åˆ¶ï¼Œæ¯ä¸ªä½œä¸šéƒ½æ˜¯ç‹¬ç«‹çš„å•ç‹¬è¿è¡Œã€‚ âš ï¸ æ¯ä¸ªä½œä¸šéƒ½æ˜¯å•ç‹¬ï¼Œç‹¬ç«‹è¿è¡Œã€‚æ‰€ä»¥ï¼Œå³ä½¿åœ¨åŒä¸€ä¸ªæµæ°´çº¿ä¸­ ä¹Ÿå°±æ˜¯åœ¨ä¸€æ¬¡ci/cdä¸­ã€‚æ¯ä¸ªä½œä¸šè¿è¡Œçš„runneréƒ½å¯èƒ½æ˜¯ä¸åŒçš„ã€‚ ä¾‹å¦‚ï¼šä½ åœ¨runner1 ä¸Šæ‹‰å–äº†ä¾èµ–ï¼Œä½ åœ¨runner2ä¸Šç¼–è¯‘äº†ä»£ç ï¼Œä½ åœ¨runner3ä¸Šå‘é€äº†ä¸€ä¸ªé€šçŸ¥ã€‚ é‚£ä¹ˆï¼Œå¦‚æœåœ¨deployæ—¶æƒ³ä½¿ç”¨ä¸Šä¸€ä¸ªé˜¶æ®µç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶è¯¥å¦‚ä½•æ“ä½œå‘¢ï¼Ÿ Caching / Artifacts ç¼“å­˜å’Œåˆ¶å“ Artifacts åˆ¶å“ï¼Œå¯ä»¥ç†è§£ä¸ºä½œä¸šäº§å‡ºçš„å†…å®¹ï¼ˆä¸Šä¸ªæµæ°´çº¿å·¥äººäº§å‡ºçš„å†…å®¹ï¼‰ ç®€å•ä»¥ä¸‹é¢è¿™ä¸ªä¸ºä¾‹ï¼š stages: - install - build - deploy install-online: stage: install image: tool/yarn:v1 script: - yarn install - yarn build:prod # å°†yarn build æ‰“åŒ…å‡ºæ¥çš„dist ä½œä¸ºåˆ¶å“ï¼Œä¼ åˆ°ä¸‹ä¸€ä¸ªjob artifacts: paths: - dist/ # é»˜è®¤æƒ…å†µä¸‹ï¼Œåé¢é˜¶æ®µçš„ä½œä¸šä¼šè‡ªåŠ¨ä¸‹è½½ç”±å‰é¢é˜¶æ®µçš„ä½œä¸šåˆ›å»ºçš„æ‰€æœ‰åˆ¶å“ã€‚ build-online-image: stage: build image: tool/docker:latest only: - master script: - docker build -t $ONLIE_IMAGE_NAME . - docker push $ONLIE_IMAGE_NAME - docker tag $ONLIE_IMAGE_NAME $IMAGE - docker push $IMAGE deploy-online: stage: deploy image: kubematrix/cli:v1 # å¦‚æœæ‚¨ä¸éœ€è¦ä¾èµ–ä»»ä½•çš„åˆ¶å“ï¼Œä½ å¯ä»¥ä½¿ç”¨dependencies: [] dependencies: [] only: - master script: - matrix workloads deploy åœ¨installæ—¶å®‰è£…ä¾èµ–å¹¶æ‰“åŒ…å‡ºä¸€ä¸ªdistæ–‡ä»¶å¤¹ï¼Œä½¿ç”¨artifactså°†è¿™ä¸ªæ–‡ä»¶å¤¹æ‰“åŒ…å‡ºæ¥ã€‚ åœ¨installæ‰§è¡Œå®Œæˆåï¼Œbuildé˜¶æ®µæ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ä¹‹å‰çš„artifacts ä¹Ÿå°±æ˜¯distæ–‡ä»¶å¤¹ï¼Œå®Œæˆäº†å°†ä¸Šä¸ªé˜¶æ®µç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶å¸¦åˆ°ä¸‹ä¸ªé˜¶æ®µçš„æ“ä½œã€‚ dependencies ä¾èµ– å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œ Cache ç¼“å­˜ ä»¥phpä¸ºä¾‹: # # https://gitlab.com/gitlab-org/gitlab/-/tree/master/lib/gitlab/ci/templates/PHP.gitlab-ci.yml # image: php:7.2 # Cache libraries in between jobs cache: key: $CI_COMMIT_REF_SLUG paths: - vendor/ before_script: # Install and run Composer - curl --show-error --silent &quot;https://getcomposer.org/installer&quot; | php - php composer.phar install test: script: - vendor/bin/phpunit --configuration phpunit.xml --coverage-text --colors=never ä»¥$CI_COMMIT_REF_SLUG(é¢„å®šä¹‰å˜é‡ï¼Œè¿™é‡Œæ˜¯æŒ‡åˆ†æ”¯çš„åç§°)ä¸ºkeyï¼Œ å°†vendor/ç›®å½•ç¼“å­˜ä¸‹æ¥ã€‚ ç¼“å­˜ä¸‹æ¥ ä»¥åçš„æ¯ä¸€æ¬¡ä½œä¸šï¼Œéƒ½ä¼šä¸‹è½½ç¼“å­˜ï¼Œè¿™æ ·ä¼šåŠ é€Ÿcomposer install çš„é€Ÿåº¦ âš ï¸éœ€è¦æ³¨æ„çš„ç‚¹ï¼š cache:key å¦‚æœä¸æŒ‡å®škeyï¼Œé‚£ä¹ˆé»˜è®¤åŒä¸€ä¸ªé¡¹ç›®çš„æ‰€æœ‰buildå…±äº«è¿™ä¸ªç¼“å­˜ã€‚å…³äºcache:keyçš„å„ç§åœºæ™¯ä½¿ç”¨ï¼Œå¯å‚è€ƒï¼šCaching in GitLab CI/CD | GitLab é»˜è®¤cacheä½¿ç”¨æœ¬åœ°ç£ç›˜ä¿å­˜ï¼Œä½†è¿™æ ·ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ã€‚å¦‚æœæ¯æ¬¡jobè¿è¡Œéƒ½åœ¨ä¸åŒçš„runnerä¸Šï¼Œé‚£ä¹ˆç¼“å­˜æ˜¯ä¸å¯ä»¥å…±äº«çš„ã€‚è¿™æ—¶å€™å°±éœ€è¦å¼•å…¥ä¸€ä¸ªåˆ†å¸ƒå¼å­˜å‚¨è¿™ä¸ªç¼“å­˜æ–‡ä»¶ã€‚ é…ç½®é˜¿é‡Œäº‘OSSå­˜å‚¨cacheæ–‡ä»¶ Advanced configuration | GitLab ä¸ºäº†ç»Ÿä¸€ç¼“å­˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨OSS é¦–å…ˆè¿›å…¥gitlab-runnerå¯¹åº”çš„ä¸»æœºï¼Œgitlab-runner list æŸ¥çœ‹é…ç½®æ–‡ä»¶å­˜æ”¾çš„ä½ç½® /etc/gitlab-runner/config.toml [[runners]] name = &quot;cloud5&quot; url = &quot;https://gitlab.xxx.cn/&quot; token = &quot;token&quot; executor = &quot;docker&quot; [runners.custom_build_dir] [runners.cache] Type = &quot;s3&quot; Shared = true Path = &quot;xxx&quot; [runners.cache.s3] ServerAddress = &quot;oss-cn-hangzhou.aliyuncs.com&quot; AccessKey = &quot;key&quot; SecretKey = &quot;sec&quot; BucketName = &quot;gitlab-runner-cached&quot; BucketLocation = &quot;oss-cn-hangzhou&quot; [runners.docker] tls_verify = false image = &quot;ruby:2.6&quot; privileged = false disable_entrypoint_overwrite = false oom_kill_disable = false disable_cache = false volumes = [&quot;/var/run/docker.sock:/var/run/docker.sock&quot;, &quot;/root/.docker/:/root/.docker/&quot;, &quot;/data/gitlab-runner/cache:/cache&quot;, &quot;/data/gitlab-runner/npm-cache:/root/.npm&quot;, &quot;/data/gitlab-runner/composer-cache:/root/.composer&quot;] shm_size = 0 pull_policy = &quot;if-not-present&quot; ä¸»è¦å†…å®¹ä¸ºä»¥ä¸‹ï¼š [runners.cache] Type = &quot;s3&quot; # ç¼“å­˜ç±»å‹ Shared = true # ç¼“å­˜åœ¨å¤šä¸ªrunnerä¹‹é—´å…±äº« Path = &quot;xxx&quot; # ç¼“å­˜è·¯å¾„å‰ç¼€ï¼Œå¦‚æœä¸€ä¸ªgitlab-runneråœ¨å¤šä¸ªgitlabä¸­æ³¨å†Œï¼Œå¯ä»¥ä½¿ç”¨å‰ç¼€çš„æ–¹å¼åšåŒºåˆ† [runners.cache.s3] ServerAddress = &quot;oss-cn-hangzhou.aliyuncs.com&quot; # ossåœ°å€ AccessKey = &quot;key&quot; # key SecretKey = &quot;sec&quot; # secret BucketName = &quot;gitlab-runner-cached&quot; # bucketName BucketLocation = &quot;oss-cn-hangzhou&quot; # BucketLocation ä»¥æ­¤ç±»æ¨ï¼Œä½ éœ€è¦åœ¨æ‰€æœ‰çš„gitlab-runnerä¸­é…ç½®æ­¤ç¼“å­˜ï¼Œè¿™æ ·æ‰€æœ‰çš„ç¼“å­˜éƒ½ä¼šè¢«ä¸Šä¼ åˆ°é˜¿é‡Œäº‘çš„OSSä¸­ï¼Œæ— è®ºä½ çš„jobè¿è¡Œåœ¨å“ªä¸ªrunnerä¸­ã€‚ ç¤ºä¾‹ï¼š ä»¥ä¸€ä¸ªå‰ç«¯é¡¹ç›®ä¸ºä¾‹ï¼š # å®šä¹‰ variables: ONLIE_IMAGE_NAME: registry.cn-hangzhou.aliyuncs.com/$CI_PROJECT_NAME:$CI_COMMIT_SHORT_SHA stages: - preInstall - install - build - deploy build-image: stage: build image: docker only: - test script: - docker build -t $IMAGE . - docker push $IMAGE # ---------------------------------- master ---------------------------------- # åªæœ‰å½“package.jsonå˜åŒ–æ—¶æ‰ä¼šé‡æ–°install preInstall-job: stage: preInstall image: yarn:v1 cache: key: $CI_COMMIT_REF_SLUG paths: - node_modules/ - yarn.lock # åªéœ€è¦æ¨é€ç¼“å­˜ï¼Œä¸éœ€è¦æ‹‰å–ç¼“å­˜ policy: push only: refs: - master changes: - package.json script: - yarn install install-online: stage: install image: yarn:v1 cache: key: $CI_COMMIT_REF_SLUG paths: - node_modules/ - yarn.lock # åªéœ€è¦æ‹‰å–ç¼“å­˜ï¼Œä¸éœ€è¦æ¨é€ç¼“å­˜ policy: pull only: - master script: # å½“ç¼“å­˜å­˜åœ¨æ—¶ä¸éœ€è¦install - if [ ! -d &quot;./node_modules/&quot; ];then yarn install; else ls -alh; fi - yarn build:prod # æ‰“åŒ…åˆ¶å“ç»™åé¢çš„job artifacts: paths: - dist/ build-online-image: stage: build # ä½¿ç”¨dockeré•œåƒ image: docker:latest # åªåœ¨masteråˆ†æ”¯å˜åŠ¨æ—¶è¿è¡Œè¿™ä¸ªjob only: - master script: - docker build -t $ONLIE_IMAGE_NAME . # æ„å»ºé•œåƒ - docker push $ONLIE_IMAGE_NAME # æ¨é€é•œåƒ deploy-online: stage: deploy # ä½¿ç”¨kubematrix-clié•œåƒ image: kubematrix/cli:v1 # ä¾èµ–ä¸ºç©ºï¼Œè¡¨ç¤ºä¸éœ€è¦ä»»ä½•çš„ä¾èµ– dependencies: [] only: - master script: - matrix workloads deploy ç¤ºä¾‹è®²è§£ GitLab CI/CD variables | GitLab å˜é‡ å¯ä»¥åœ¨æ–‡æ¡£Predefined variables reference | GitLab ä¸­æŸ¥çœ‹é¢„å®šä¹‰çš„å˜é‡ é¦–å…ˆå®šä¹‰å˜é‡ ONLIE_IMAGE_NAME ä»¥ä¾›ä½¿ç”¨ å®šä¹‰stages æµæ°´çº¿é˜¶æ®µ å®šä¹‰äº†4ä¸ªé˜¶æ®µï¼ŒpreInstallï¼Œinstallï¼Œbuildï¼Œdeployï¼Œä¸‹é¢çš„jobå°†æŒ‰ç…§å…³è”çš„stagé¡ºåºæ‰§è¡Œ å®šä¹‰job stag å®šä¹‰äº†jobå¯¹åº”çš„é˜¶æ®µã€‚ imageï¼šå®šä¹‰äº†æ‰§è¡Œè„šæœ¬æ‰€ä½¿ç”¨çš„dockeré•œåƒã€‚ only ï¼š å®šä¹‰äº†jobåªåœ¨æŸäº›æƒ…å†µä¸‹æ‰§è¡Œã€‚é»˜è®¤ä¸ºonly.refsè¾“å…¥åˆ†æ”¯åï¼Œæˆ–ä¸åˆ†æ”¯ç›¸åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚only.changes æ£€æµ‹åªåœ¨æŸäº›æ–‡ä»¶å˜åŠ¨æ—¶è¿è¡Œã€‚ cache ï¼š å®šä¹‰äº†æ”¹jobä½¿ç”¨ç¼“å­˜ï¼Œcache.policy ç¼“å­˜è§„åˆ™ï¼Œé»˜è®¤ä¸ºpull-pushå¼€å§‹jobå‰æ‹‰å–ç¼“å­˜,jobæˆåŠŸåæ¨é€ç¼“å­˜ã€‚ å¯ä¿®æ”¹ä¸ºpushåªæ¨é€ï¼Œä¸æ‹‰å–ã€‚pullåªæ‹‰å–ï¼Œä¸æ¨é€ artifactsï¼š å®šä¹‰äº†éœ€è¦æ‰“åŒ…çš„åˆ¶å“ï¼Œç»™åé¢çš„jobä½¿ç”¨ dependencies : éœ€è¦çš„ä¾èµ–ï¼Œå¦‚æœä¸Šé¢çš„jobæœ‰artifacts ä¼šé»˜è®¤ä¸‹è½½ï¼Œå¦‚æœä¸éœ€è¦artifacts å¯å°†è¿™ä¸ªå±æ€§å®šä¹‰ä¸ºç©ºæ•°ç»„ ","link":"https://marunrun.github.io/gitlab-cicd/"},{"title":"androidé€†å‘ 360åŠ å›ºapkï¼Œfrida Hook javaä»£ç ","content":"å‚è€ƒæ–‡ç« ï¼š https://www.52pojie.cn/forum.php?mod=viewthread&amp;tid=1287307 ä¹¦æ¥ä¸Šæ–‡ï¼Œè¿™æ¬¡æˆ‘ä¼šå°è¯•apkçš„é€†å‘ï¼Œæ‰¾åˆ°appä¸èƒ½æŠ“åŒ…çš„åŸå›  å¦‚å›¾æ‰€ç¤ºï¼Œè¿™ä¸ªappè¢«360åŠ å›ºäº†ï¼Œå‡ ç»ç™¾åº¦ï¼ŒæŒ‰ç…§å¼€å¤´é‚£ç¯‡æ–‡ç« çš„å‚è€ƒï¼Œæˆ‘ä»¬å¾—åˆ°äº†dexæ–‡ä»¶ å°†å¤šä¸ªdexæ–‡ä»¶ ç§»åŠ¨åˆ°ç”µè„‘ä¸Š ç”±äºæœ‰å¤šä¸ªdexæ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åˆå¹¶æŸ¥çœ‹ä»£ç  jadxå·¥å…·ï¼š https://github.com/skylot/jadx/ å…·ä½“ä»£ç å¦‚ä¸‹ import os, sys # python3.7 merge_dex.py ./file/ livedex if __name__ == &quot;__main__&quot;: if len(sys.argv) &lt; 3 : print(&quot;start error&quot;) sys.exit() print(sys.argv[1], sys.argv[2]) path = sys.argv[1] #æ–‡ä»¶å¤¹ç›®å½• files= os.listdir(path) #å¾—åˆ°æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åç§° s = [] for file in files: #éå†æ–‡ä»¶å¤¹ if file.find(&quot;dex&quot;) &gt; 0: ## æŸ¥æ‰¾dex æ–‡ä»¶ sh = 'jadx.bat -j 1 -r -d ' + sys.argv[2] + &quot; &quot; + path + file print(sh) os.system(sh) æœ€ç»ˆç»“æœå°±æ˜¯è¿™æ ·äº†ï¼Œå…·ä½“ä»£ç å°±ä¸æ”¾äº†ã€‚ ç»è¿‡æŸ¥çœ‹æºç ï¼Œå‘ç°æ˜¯okHttpè®¾ç½®äº†no_proxy åªéœ€è¦å°†è¿™ä¸€éƒ¨åˆ†ä»£ç hookæ‰å°±okäº†ã€‚ æˆ‘ä½¿ç”¨çš„frida ï¼šhttps://github.com/frida/frida ç”µè„‘ä½¿ç”¨pip install // ç”µè„‘å®‰è£…frida pip install frida-tools # CLI tools pip install frida # Python bindings // å°†frida-serveræ¨åˆ°æ‰‹æœº adb.exe push .\\frida-server-14.0.7-android-arm64 /data/local/tmp/frida-server // è¿æ¥åˆ°æ‰‹æœº adb shell cd /data/local/tmp // åˆ‡åˆ°rootç”¨æˆ· su // ä¿®æ”¹æƒé™ chmod 777 frida-server // æ‰§è¡Œ ./frida-server ä¸Šé¢å°±å°†æ‰‹æœºçš„frida-serverå¼€å¯äº†ï¼Œç„¶ååœ¨ç”µè„‘ä¸Šè¯•è¯•æ˜¯å¦å¯ä»¥æˆåŠŸè¿æ¥ frida-ps.exe -U å¦‚æœæœ‰æ˜¾ç¤ºæ‰‹æœºç›¸å…³è¿›ç¨‹å°±ok å°†è‡ªå·±ç¼–å†™çš„jsä»£ç æ¨åˆ°æ‰‹æœº è¿›è¡Œ hook frida -U --no-pause -f com.showstartfans.activity -l .\\showstart.js showstart.js ä»£ç : Java.perform( function () { var application = Java.use(&quot;android.app.Application&quot;); application.attach.overload('android.content.Context').implementation = function(context) { var result = this.attach(context); // å…ˆæ‰§è¡ŒåŸæ¥çš„attachæ–¹æ³• var classloader = context.getClassLoader(); Java.classFactory.loader = classloader; var Hook_class = Java.classFactory.use(&quot;com.taihebase.activity.utils.SecurityUtil&quot;); console.log(&quot;Hook_class: &quot; + Hook_class); Hook_class.getNeedCapturePacket.implementation = function(){ return true; } return result; } } ) fridaå…³äºjavaçš„å®˜æ–¹æ–‡æ¡£: https://frida.re/docs/javascript-api/#java è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨fiddlerå®‰å¿ƒçš„æŠ“æ¥å£äº† æ•…æŠ€é‡æ–½~ åˆå¯ä»¥æµç•…çš„ä¸‹å•è´­ç¥¨äº†ã€‚ ","link":"https://marunrun.github.io/android-ni-xiang-360-jia-gu-apkfrida-hook-java-dai-ma/"},{"title":"fiddler-å®æˆ˜ ","content":"å‰è¨€ï¼š å‰æ®µæ—¶é—´çœ‹äº†ä¸€æ¡£Bç«™çš„ç»¼è‰ºï¼šã€Šè¯´å”±æ–°ä¸–ä»£ã€‹ï¼Œæœ€è¿‘èŠ‚ç›®é‡Œé¢çš„é€‰æ‰‹å¼€å§‹å·¡æ¼”ã€‚æƒ³ä¹°ç¥¨å»çœ‹çœ‹çš„ï¼Œåœ¨ç§€åŠ¨ä¸Šæ²¡ä¹°åˆ°ç¥¨ï¼Œå¾ˆæ°”ã€‚soï¼Œæƒ³æƒ³åŠæ³•å§ï¼Œäºæ˜¯æœ‰äº†ä»¥ä¸‹è®°å½•ã€‚ ä¸€ï¼Œå°è¯•APPæŠ“åŒ…çœ‹çœ‹ æŠ“åŒ…å·¥å…·ï¼šFiddler å…·ä½“é…ç½®ä¸å†èµ˜è¿°ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šæ–‡ç« éƒ½æœ‰è®² Appé…ç½®wifiä»£ç†8888 å¾ˆå¯æƒœï¼ŒAppå¹¶æ²¡æœ‰æˆåŠŸï¼ŒåªæŠ“åˆ°å‡ å¼ å›¾ç‰‡çš„ğŸ˜­ äºŒï¼Œå°è¯•wapç«¯ æ—¢ç„¶Appç«¯ä¸å¯ä»¥çš„è¯ï¼Œé‚£å°±å°è¯•ä¸€ä¸‹wapç«¯å§ã€‚ å‘ï¼Œè¿™é‡Œæ˜¾ç¤ºåªèƒ½å»appè´­ä¹°ï¼Œå¯æ¶ğŸ˜¤ï¼Œå³é”®æ£€æŸ¥ä¸€ä¸‹ã€‚ è¿™é‡ŒåŠ å…¥äº†ä¸€ä¸ªidï¼Œæ‰’ä¸‹jsï¼Œdetail.js è¿™é‡Œåˆ¤æ–­äº†activity.type == 6 ï¼Œçœ‹ä¸‹æ¥å£ï¼Œå“ªé‡Œæœ‰type : 6çš„ å‘ï¼Œä¸å‡ºæ„å¤–å°±æ˜¯è¿™é‡Œäº†ï¼Œæˆ‘ä»¬ä½¿ç”¨fillder æ‹¦æˆªresponse ï¼Œä¿®æ”¹è¿™ä¸ªtype ç¬¬ä¸€æ­¥ï¼ŒåŒå‡»è¿™ç©æ„å„¿ï¼Œå¼€å¯responseæ‹¦æˆªåŠŸèƒ½ ï¼ˆæ³¨æ„è¿™é‡Œä¼šæ‹¦æˆªæ‰€æœ‰çš„responseï¼Œåœ¨æ²¡æœ‰æŠ“åˆ°ä½ æƒ³è¦çš„æ¥å£æ—¶ï¼Œå…ˆç‚¹ä¸Šé¢çš„go æ”¾è¡Œæ‰€æœ‰çš„è¯·æ±‚ï¼Œç›´åˆ°ä½ æƒ³è¦çš„æ¥å£å‡ºç°ï¼‰ ç¬¬äºŒæ­¥ï¼Œæœåˆ°æƒ³è¦ä¿®æ”¹çš„å€¼ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯&quot;type&quot;:6 æ”¹ä¸ºtype:1 ç¬¬ä¸‰æ­¥ï¼Œä¿®æ”¹æˆåŠŸåç‚¹å‡»è¿™ä¸ªrun to xxxxçš„ç»¿è‰²æŒ‰é’®ï¼Œå†æŠŠç¬¬ä¸€æ­¥è¿™é‡Œè¿˜åŸå°±è¡Œ å¥½äº†ï¼Œæ¥çœ‹çœ‹ç°åœ¨çš„é¡µé¢ ä»åªèƒ½appè´­ä¹°ï¼Œå˜æˆäº†ç«‹å³è´­ç¥¨ niceï¼Œå…„å¼Ÿã€‚ç¬¬ä¸€æ­¥å®Œæˆäº† æˆ‘ä»¬ç‚¹å‡»ç«‹å³è´­ç¥¨ å¯æƒœè¿™é‡Œæ˜¾ç¤ºå³å°†å¼€å”®ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªåœ°æ–¹çš„æ¥å£ è¿™é‡Œæˆ‘ä»¬æ•…æŠ€é‡æ–½ï¼ŒæŠŠè¿™é‡Œçš„0 éƒ½æ”¹æˆ10ï¼Œ æ³¨æ„è¿™é‡Œçš„salesStatusä¹Ÿéœ€è¦æ”¹æˆ1 å‘ï¼Œè¿™é‡Œå°±å¯ä»¥ç›´æ¥ç‚¹ç«‹å³è´­ä¹°äº†,ç‚¹è¿›å»å°±ä¸‹å•é¡µäº†ã€‚ è¿™é‡Œçš„å·²å”®ç½„å…¶å®ä¹Ÿå¯ä»¥æ”¹ï¼ŒåŒæ ·é€šè¿‡fiddler æ”¹æ¥å£ï¼Œæˆ‘å°±ä¸å†æ¼”ç¤ºäº†ã€‚ by the way , è¿™é‡Œå¦‚æœç›´æ¥è¿›æ¥çš„è¯ï¼Œå…¶å®ç›´æ¥é€šè¿‡urlä¸‹æ¬¡å†è¿›æ¥äº†ï¼Œå°±ä¸ç”¨å‰é¢çš„å‡ æ­¥æ“ä½œäº†ï¼Œé“¾æ¥æ”¾ä¸‹é¢ https://wap.showstart.com/pages/order/activity/confirm/confirm?sequence=123744&amp;ticketId=2d80ca0d806844cba6915518356f76c6&amp;ticketNum=1 ","link":"https://marunrun.github.io/fiddler-shi-zhan-yi/"},{"title":"mysqlä¸­ group byæ’åºï¼Œderived_mergeä¼˜åŒ–çš„å‘","content":"ä¸€ä¸ªç®€å•çš„è¡¨ CREATE TABLE `test` ( `id` int(11) NOT NULL AUTO_INCREMENT, `spu_id` int(11) DEFAULT NULL, `price` decimal(10,2) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci; å¤§æ¦‚å†…å®¹ id spu_id price 1 100 200 2 100 100 3 200 400 4 200 200 å¯¹spu_idè¿›è¡Œåˆ†ç»„ï¼ŒæŒ‰priceä»å°åˆ°å¤§æ’åºï¼š SELECT * FROM `test` GROUP BY spu_id ORDER BY price ç›´æ¥ä½¿ç”¨group by æŸ¥å‡ºæ¥çš„æ•°æ®æ˜¯æŒ‰idé¡ºåºåˆ†ç»„çš„ï¼Œå¹¶æœªè¾¾åˆ°é¢„æœŸ å°è¯•ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå…ˆæ’åºå†åˆ†ç»„ SELECT * FROM ( SELECT * FROM `test` ORDER BY price ) AS tmp GROUP BY spu_id æ³¨æ„ï¼šè¿™ä¸ªæ–¹å¼åœ¨ä½ç‰ˆæœ¬ä¸­æœ‰æ•ˆã€‚åœ¨5.7ç‰ˆæœ¬ä¸­å¼•å…¥æ–°ç‰¹æ€§ derived_mergeä¼˜åŒ–è¿‡åæ— æ•ˆäº†ã€‚ å…·ä½“æ— æ•ˆåŸå› æˆ‘ä»¬å¯ä½¿ç”¨explain åˆ†æ EXPLAIN SELECT * FROM ( SELECT * FROM `test` ORDER BY price) AS tmp GROUP BY spu_id; å¦‚å›¾æ‰€ç¤ºï¼š MySQL å°†å­æŸ¥è¯¢ä¼˜åŒ–æˆäº†ä¸€ä¸ªç®€å•æŸ¥è¯¢ï¼Œå­æŸ¥è¯¢ä¸­çš„æ’åºæ— æ•ˆ~ è§£å†³æ–¹æ³•ï¼š å°†derived_merge å…³é—­ SET optimizer_switch='derived_merge=off'; SET GLOBAL optimizer_switch='derived_merge=off'; ä½¿ç”¨ç‰¹æ®Šçš„æŸ¥è¯¢é˜»æ­¢ derived_merge ä¼˜åŒ– å¯ä»¥é€šè¿‡åœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨ä»»ä½•é˜»æ­¢åˆå¹¶çš„æ„é€ æ¥ç¦ç”¨åˆå¹¶ï¼Œå°½ç®¡è¿™äº›æ„é€ å¯¹å®ç°çš„å½±å“ä¸é‚£ä¹ˆæ˜æ˜¾ã€‚é˜²æ­¢åˆå¹¶çš„æ„é€ ä¸æ´¾ç”Ÿè¡¨å’Œè§†å›¾å¼•ç”¨ç›¸åŒï¼š èšåˆå‡½æ•°ï¼ˆSUM()ï¼Œ MIN()ï¼Œ MAX()ï¼Œ COUNT()ï¼Œç­‰ç­‰ï¼‰ DISTINCT GROUP BY HAVING LIMIT UNION è¦ä¹ˆ UNION ALL é€‰æ‹©åˆ—è¡¨ä¸­çš„å­æŸ¥è¯¢ åˆ†é…ç»™ç”¨æˆ·å˜é‡ ä»…å¼•ç”¨æ–‡å­—å€¼ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡æœ‰åŸºç¡€è¡¨ï¼‰ ä»¥ä¸Šå†…å®¹å‚è€ƒæ–‡æ¡£ï¼šmysqlæ–‡æ¡£ é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„é‚£æ¡sqlè¯­å¥ä¿®æ”¹ä¸ºï¼š SELECT * FROM ( SELECT * FROM `test` HAVING 1=1 ORDER BY price ) AS tmp GROUP BY spu_id; ä½¿ç”¨ having æ¥é˜»æ­¢åˆå¹¶ é‚£ä¹ˆå†ç”¨explainçœ‹çœ‹ å¦‚æœ‰é”™è¯¯è¯·æŒ‡æ­£~ è¯·å¤šåŒ…æ¶µ ","link":"https://marunrun.github.io/mysql-group-by-pai-xu-derived_merge-you-hua-de-keng/"},{"title":" åœ¨ Hyperf æ¡†æ¶ä¸­ä½¿ç”¨ prometheus + grafana éƒ¨ç½²åŸºæœ¬çš„ç›‘æ§","content":"å‚è€ƒï¼š hyperfåˆ©ç”¨prometheusæ¥å…¥æœåŠ¡ç›‘æ§,ä½¿ç”¨grafanaå®ç°æ•°æ®çš„å®æ—¶ç›‘æ§æ˜¾ç¤º hyperfæ–‡æ¡£ æœ¬æ–‡ç« è®°å½•æœ¬äººçš„ç¬¬ä¸€æ¬¡éƒ¨ç½²æ‰€è¸©çš„å‘ï¼Œæœªæ·±å…¥äº†è§£prometheus å’Œgrafana å¦‚æœ‰ä¸å½“çš„åœ°æ–¹è¯·æŒ‡æ­£ï¼Œè°¢è°¢ï¼ ä¸€. ä½¿ç”¨docker-composeéƒ¨ç½² version: '2' networks: monitor: driver: bridge services: prometheus: image: prom/prometheus container_name: prometheus hostname: prometheus restart: always volumes: # å°†ä½ çš„prometheus.ymlæ–‡ä»¶æ”¾åœ¨å½“å‰æ–‡ä»¶åŒçº§ä¸‹ï¼Œæˆ–è‡ªå®šä¹‰ - ./prometheus.yml:/etc/prometheus/prometheus.yml #- /home/prometheus/node_down.yml:/etc/prometheus/node_down.yml ports: - &quot;9090:9090&quot; networks: monitor: ipv4_address: 172.18.0.3 grafana: image: grafana/grafana container_name: grafana hostname: grafana restart: always volumes: # åˆ›å»º etcç›®å½•ï¼Œdataç›®å½•å­˜å‚¨grafanaçš„æ•°æ® - ./etc:/etc/grafana - ./data:/var/lib/grafana ports: - &quot;3000:3000&quot; networks: monitor: ipv4_address: 172.18.0.4 node-exporter: image: prom/node-exporter container_name: node-exporter hostname: node-exporter restart: always ports: - &quot;9100:9100&quot; networks: monitor: ipv4_address: 172.18.0.2 æ³¨æ„ï¼šä¸ºäº†é¿å…æ¯æ¬¡docker-compose å¯åŠ¨ä¹‹å ipä¼šå‘ç”Ÿå˜åŒ–ï¼Œæˆ‘è¿™é‡Œé…ç½®äº†å›ºå®šIPï¼Œè¯·æ ¹æ®ä¸ªäººå®é™…æƒ…å†µé…ç½®ï¼Œæˆ–å‚é˜…dockerç›¸å…³æ–‡æ¡£ ä½¿ç”¨å‘½ä»¤docker-compose upå¯åŠ¨å®¹å™¨ äºŒ. é¡¹ç›®é…ç½® å› ä¸ºå¯¹ prometheusçš„ä¸äº†è§£ï¼Œæˆ‘ç›´æ¥ä½¿ç”¨hyperfé»˜è®¤é…ç½® å¼•å…¥ç»„ä»¶ composer require hyperf/metric å‘å¸ƒé»˜è®¤é…ç½®æ–‡ä»¶ php bin/hyperf.php vendor:publish hyperf/metric åœ¨config/autoload/dependencies.phpä¸­æ·»åŠ å¯¹åº”çš„Rediså­˜å‚¨ return [ \\Prometheus\\Storage\\Adapter::class =&gt; \\Hyperf\\Metric\\Adapter\\Prometheus\\RedisStorageFactory::class, ]; åœ¨ä¸Šé¢çš„ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œè€å“¥è¯´ä½¿ç”¨swoole_tableæ›´é«˜æ•ˆï¼Œæˆ‘è¿˜ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨ï¼Œæœ‰å…´è¶£çš„è€å“¥å¯ä»¥è‡ªå·±ç ”ç©¶ä¸€ä¸‹ã€‚ å¢åŠ ä¸­é—´ä»¶ åœ¨config/autoload/middlewares.phpæ–‡ä»¶ä¸­å¢åŠ å¯¹åº”çš„ä¸­é—´ä»¶ return [ 'http' =&gt; [ \\Hyperf\\Metric\\Middleware\\MetricMiddleware::class, ], ]; æ·»åŠ  metricsè·¯ç”± Router::get('/metrics', function(){ $registry = Hyperf\\Utils\\ApplicationContext::getContainer()-&gt;get(Prometheus\\CollectorRegistry::class); $renderer = new Prometheus\\RenderTextFormat(); return $renderer-&gt;render($registry-&gt;getMetricFamilySamples()); }); è¿™æ ·å¯¹é¡¹ç›®çš„é…ç½®å°±å®Œæˆäº† ä¸‰. prometheusçš„é…ç½® åœ¨ prometheus.ymlæ–‡ä»¶ä¸­å¢åŠ å¯¹åº”çš„é…ç½® scrape_configs: # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config. - job_name: 'prometheus' # metrics_path defaults to '/metrics' # scheme defaults to 'http'. static_configs: - targets: ['localhost:9090'] - job_name: 'node' # æ³¨æ„è¿™é‡Œçš„IPéœ€è¦å¡«å†™ node-exporter å®¹å™¨çš„ip static_configs: - targets: ['172.18.0.2:9100'] - job_name: 'skeleton' # è¿™é‡Œå¡«å†™çš„æ˜¯å®¿ä¸»æœºçš„ip static_configs: - targets: ['10.0.75.1:9502'] é…ç½®å®Œæˆä¹‹åï¼Œå†æ¬¡ dokcer-compose up è®¿é—® http://localhost:9090 æŸ¥çœ‹ prometheus å¦‚å›¾æ‰€ç¤ºï¼Œnode å’Œ skeleton éƒ½å·²å¯åŠ¨ å››. Grafana é…ç½® ä¸Šé¢éƒ½é…ç½®å®Œäº†ï¼Œå¼€å§‹é…ç½® Grafana æ‰“å¼€ http://localhost:3000 é»˜è®¤å¯†ç æ˜¯: admin/admin æ–°å»ºdatasource å·¦ä¾§è¾¹æ  add datasources é€‰æ‹©Prometheus é…ç½® datasource å¡«å†™å®¹å™¨çš„IP:ç«¯å£ å¯¼å…¥hyperfå®˜æ–¹çš„JSONæ–‡ä»¶ å¯¼å…¥ä¹‹åéœ€è¦å°†é»˜è®¤çš„ app_nameæ”¹æˆä½ è‡ªå·±çš„ å¦‚ï¼šadmin-api å°±éœ€è¦å¡«å†™admin_api æ”¹æˆä¸‹åˆ’çº¿å½¢å¼ æŸ¥çœ‹ç›‘æ§ åœ¨Homeä¸­ä½ å°±å¯ä»¥çœ‹åˆ°äº† ç‚¹è¿›å»æŸ¥çœ‹ åˆ°æ­¤ç»“æŸï¼Œå°ç™½ç¬¬ä¸€æ¬¡é…ç½®ç›‘æ§ï¼Œè¿˜æœ‰å¾ˆå¤šä¸œè¥¿æ²¡å¼„æ¸…æ¥š ","link":"https://marunrun.github.io/hyperf-grafana/"}]}