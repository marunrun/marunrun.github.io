{"posts":[{"title":"fiddler-å®æˆ˜ ä¸€","content":"å‰è¨€ï¼šå‰æ®µæ—¶é—´çœ‹äº†ä¸€æ¡£Bç«™çš„ç»¼è‰ºï¼šã€Šè¯´å”±æ–°ä¸–ä»£ã€‹ï¼Œæœ€è¿‘èŠ‚ç›®é‡Œé¢çš„é€‰æ‰‹å¼€å§‹å·¡æ¼”ã€‚æƒ³ä¹°ç¥¨å»çœ‹çœ‹çš„ï¼Œåœ¨ç§€åŠ¨ä¸Šæ²¡ä¹°åˆ°ç¥¨ï¼Œå¾ˆæ°”ã€‚soï¼Œæƒ³æƒ³åŠæ³•å§ï¼Œäºæ˜¯æœ‰äº†ä»¥ä¸‹è®°å½•ã€‚ä¸€ï¼Œå°è¯•APPæŠ“åŒ…çœ‹çœ‹æŠ“åŒ…å·¥å…·ï¼šFiddlerå…·ä½“é…ç½®ä¸å†èµ˜è¿°ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šæ–‡ç« éƒ½æœ‰è®²Appé…ç½®wifiä»£ç†8888å¾ˆå¯æƒœï¼ŒAppå¹¶æ²¡æœ‰æˆåŠŸï¼ŒåªæŠ“åˆ°å‡ å¼ å›¾ç‰‡çš„ğŸ˜­äºŒï¼Œå°è¯•wapç«¯æ—¢ç„¶Appç«¯ä¸å¯ä»¥çš„è¯ï¼Œé‚£å°±å°è¯•ä¸€ä¸‹wapç«¯å§ã€‚å‘ï¼Œè¿™é‡Œæ˜¾ç¤ºåªèƒ½å»appè´­ä¹°ï¼Œå¯æ¶ğŸ˜¤ï¼Œå³é”®æ£€æŸ¥ä¸€ä¸‹ã€‚è¿™é‡ŒåŠ å…¥äº†ä¸€ä¸ªidï¼Œæ‰’ä¸‹jsï¼Œdetail.jsè¿™é‡Œåˆ¤æ–­äº†activity.type==6ï¼Œçœ‹ä¸‹æ¥å£ï¼Œå“ªé‡Œæœ‰type:6çš„å‘ï¼Œä¸å‡ºæ„å¤–å°±æ˜¯è¿™é‡Œäº†ï¼Œæˆ‘ä»¬ä½¿ç”¨fillderæ‹¦æˆªresponseï¼Œä¿®æ”¹è¿™ä¸ªtypeç¬¬ä¸€æ­¥ï¼ŒåŒå‡»è¿™ç©æ„å„¿ï¼Œå¼€å¯responseæ‹¦æˆªåŠŸèƒ½ï¼ˆæ³¨æ„è¿™é‡Œä¼šæ‹¦æˆªæ‰€æœ‰çš„responseï¼Œåœ¨æ²¡æœ‰æŠ“åˆ°ä½ æƒ³è¦çš„æ¥å£æ—¶ï¼Œå…ˆç‚¹ä¸Šé¢çš„goæ”¾è¡Œæ‰€æœ‰çš„è¯·æ±‚ï¼Œç›´åˆ°ä½ æƒ³è¦çš„æ¥å£å‡ºç°ï¼‰ç¬¬äºŒæ­¥ï¼Œæœåˆ°æƒ³è¦ä¿®æ”¹çš„å€¼ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯&quot;type&quot;:6æ”¹ä¸ºtype:1ç¬¬ä¸‰æ­¥ï¼Œä¿®æ”¹æˆåŠŸåç‚¹å‡»è¿™ä¸ªruntoxxxxçš„ç»¿è‰²æŒ‰é’®ï¼Œå†æŠŠç¬¬ä¸€æ­¥è¿™é‡Œè¿˜åŸå°±è¡Œå¥½äº†ï¼Œæ¥çœ‹çœ‹ç°åœ¨çš„é¡µé¢ä»åªèƒ½appè´­ä¹°ï¼Œå˜æˆäº†ç«‹å³è´­ç¥¨niceï¼Œå…„å¼Ÿã€‚ç¬¬ä¸€æ­¥å®Œæˆäº†æˆ‘ä»¬ç‚¹å‡»ç«‹å³è´­ç¥¨å¯æƒœè¿™é‡Œæ˜¾ç¤ºå³å°†å¼€å”®ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªåœ°æ–¹çš„æ¥å£è¿™é‡Œæˆ‘ä»¬æ•…æŠ€é‡æ–½ï¼ŒæŠŠè¿™é‡Œçš„0éƒ½æ”¹æˆ10ï¼Œæ³¨æ„è¿™é‡Œçš„salesStatusä¹Ÿéœ€è¦æ”¹æˆ1å‘ï¼Œè¿™é‡Œå°±å¯ä»¥ç›´æ¥ç‚¹ç«‹å³è´­ä¹°äº†,ç‚¹è¿›å»å°±ä¸‹å•é¡µäº†ã€‚è¿™é‡Œçš„å·²å”®ç½„å…¶å®ä¹Ÿå¯ä»¥æ”¹ï¼ŒåŒæ ·é€šè¿‡fiddleræ”¹æ¥å£ï¼Œæˆ‘å°±ä¸å†æ¼”ç¤ºäº†ã€‚bytheway,è¿™é‡Œå¦‚æœç›´æ¥è¿›æ¥çš„è¯ï¼Œå…¶å®ç›´æ¥é€šè¿‡urlä¸‹æ¬¡å†è¿›æ¥äº†ï¼Œå°±ä¸ç”¨å‰é¢çš„å‡ æ­¥æ“ä½œäº†ï¼Œé“¾æ¥æ”¾ä¸‹é¢https://wap.showstart.com/pages/order/activity/confirm/confirm?sequence=123744&amp;ticketId=2d80ca0d806844cba6915518356f76c6&amp;ticketNum=1","link":"https://marunrun.github.io/post/fiddler-shi-zhan-yi/"},{"title":"mysqlä¸­ group byæ’åºï¼Œderived_mergeä¼˜åŒ–çš„å‘","content":"ä¸€ä¸ªç®€å•çš„è¡¨CREATETABLE`test`(`id`int(11)NOTNULLAUTO_INCREMENT,`spu_id`int(11)DEFAULTNULL,`price`decimal(10,2)DEFAULTNULL,PRIMARYKEY(`id`))ENGINE=InnoDBDEFAULTCHARSET=utf8mb4COLLATE=utf8mb4_unicode_ci;å¤§æ¦‚å†…å®¹idspu_idprice1100200210010032004004200200å¯¹spu_idè¿›è¡Œåˆ†ç»„ï¼ŒæŒ‰priceä»å°åˆ°å¤§æ’åºï¼šSELECT*FROM`test`GROUPBYspu_idORDERBYpriceç›´æ¥ä½¿ç”¨groupbyæŸ¥å‡ºæ¥çš„æ•°æ®æ˜¯æŒ‰idé¡ºåºåˆ†ç»„çš„ï¼Œå¹¶æœªè¾¾åˆ°é¢„æœŸå°è¯•ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå…ˆæ’åºå†åˆ†ç»„SELECT*FROM(SELECT*FROM`test`ORDERBYprice)AStmpGROUPBYspu_idæ³¨æ„ï¼šè¿™ä¸ªæ–¹å¼åœ¨ä½ç‰ˆæœ¬ä¸­æœ‰æ•ˆã€‚åœ¨5.7ç‰ˆæœ¬ä¸­å¼•å…¥æ–°ç‰¹æ€§derived_mergeä¼˜åŒ–è¿‡åæ— æ•ˆäº†ã€‚å…·ä½“æ— æ•ˆåŸå› æˆ‘ä»¬å¯ä½¿ç”¨explainåˆ†æEXPLAINSELECT*FROM(SELECT*FROM`test`ORDERBYprice)AStmpGROUPBYspu_id;å¦‚å›¾æ‰€ç¤ºï¼šMySQLå°†å­æŸ¥è¯¢ä¼˜åŒ–æˆäº†ä¸€ä¸ªç®€å•æŸ¥è¯¢ï¼Œå­æŸ¥è¯¢ä¸­çš„æ’åºæ— æ•ˆ~è§£å†³æ–¹æ³•ï¼šå°†derived_mergeå…³é—­SEToptimizer_switch='derived_merge=off';SETGLOBALoptimizer_switch='derived_merge=off';ä½¿ç”¨ç‰¹æ®Šçš„æŸ¥è¯¢é˜»æ­¢derived_mergeä¼˜åŒ–å¯ä»¥é€šè¿‡åœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨ä»»ä½•é˜»æ­¢åˆå¹¶çš„æ„é€ æ¥ç¦ç”¨åˆå¹¶ï¼Œå°½ç®¡è¿™äº›æ„é€ å¯¹å®ç°çš„å½±å“ä¸é‚£ä¹ˆæ˜æ˜¾ã€‚é˜²æ­¢åˆå¹¶çš„æ„é€ ä¸æ´¾ç”Ÿè¡¨å’Œè§†å›¾å¼•ç”¨ç›¸åŒï¼šèšåˆå‡½æ•°ï¼ˆSUM()ï¼ŒMIN()ï¼ŒMAX()ï¼ŒCOUNT()ï¼Œç­‰ç­‰ï¼‰DISTINCTGROUPBYHAVINGLIMITUNIONè¦ä¹ˆUNIONALLé€‰æ‹©åˆ—è¡¨ä¸­çš„å­æŸ¥è¯¢åˆ†é…ç»™ç”¨æˆ·å˜é‡ä»…å¼•ç”¨æ–‡å­—å€¼ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡æœ‰åŸºç¡€è¡¨ï¼‰ä»¥ä¸Šå†…å®¹å‚è€ƒæ–‡æ¡£ï¼šmysqlæ–‡æ¡£é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„é‚£æ¡sqlè¯­å¥ä¿®æ”¹ä¸ºï¼šSELECT*FROM(SELECT*FROM`test`HAVING1=1ORDERBYprice)AStmpGROUPBYspu_id;ä½¿ç”¨havingæ¥é˜»æ­¢åˆå¹¶é‚£ä¹ˆå†ç”¨explainçœ‹çœ‹å¦‚æœ‰é”™è¯¯è¯·æŒ‡æ­£~è¯·å¤šåŒ…æ¶µ","link":"https://marunrun.github.io/post/mysql-group-by-pai-xu-derived_merge-you-hua-de-keng/"},{"title":" åœ¨ Hyperf æ¡†æ¶ä¸­ä½¿ç”¨ prometheus + grafana éƒ¨ç½²åŸºæœ¬çš„ç›‘æ§","content":"å‚è€ƒï¼šhyperfåˆ©ç”¨prometheusæ¥å…¥æœåŠ¡ç›‘æ§,ä½¿ç”¨grafanaå®ç°æ•°æ®çš„å®æ—¶ç›‘æ§æ˜¾ç¤ºhyperfæ–‡æ¡£æœ¬æ–‡ç« è®°å½•æœ¬äººçš„ç¬¬ä¸€æ¬¡éƒ¨ç½²æ‰€è¸©çš„å‘ï¼Œæœªæ·±å…¥äº†è§£prometheuså’Œgrafanaå¦‚æœ‰ä¸å½“çš„åœ°æ–¹è¯·æŒ‡æ­£ï¼Œè°¢è°¢ï¼ä¸€.ä½¿ç”¨docker-composeéƒ¨ç½²version:'2'networks:monitor:driver:bridgeservices:prometheus:image:prom/prometheuscontainer_name:prometheushostname:prometheusrestart:alwaysvolumes:#å°†ä½ çš„prometheus.ymlæ–‡ä»¶æ”¾åœ¨å½“å‰æ–‡ä»¶åŒçº§ä¸‹ï¼Œæˆ–è‡ªå®šä¹‰-./prometheus.yml:/etc/prometheus/prometheus.yml#-/home/prometheus/node_down.yml:/etc/prometheus/node_down.ymlports:-&quot;9090:9090&quot;networks:monitor:ipv4_address:172.18.0.3grafana:image:grafana/grafanacontainer_name:grafanahostname:grafanarestart:alwaysvolumes:#åˆ›å»ºetcç›®å½•ï¼Œdataç›®å½•å­˜å‚¨grafanaçš„æ•°æ®-./etc:/etc/grafana-./data:/var/lib/grafanaports:-&quot;3000:3000&quot;networks:monitor:ipv4_address:172.18.0.4node-exporter:image:prom/node-exportercontainer_name:node-exporterhostname:node-exporterrestart:alwaysports:-&quot;9100:9100&quot;networks:monitor:ipv4_address:172.18.0.2æ³¨æ„ï¼šä¸ºäº†é¿å…æ¯æ¬¡docker-composeå¯åŠ¨ä¹‹åipä¼šå‘ç”Ÿå˜åŒ–ï¼Œæˆ‘è¿™é‡Œé…ç½®äº†å›ºå®šIPï¼Œè¯·æ ¹æ®ä¸ªäººå®é™…æƒ…å†µé…ç½®ï¼Œæˆ–å‚é˜…dockerç›¸å…³æ–‡æ¡£ä½¿ç”¨å‘½ä»¤docker-composeupå¯åŠ¨å®¹å™¨äºŒ.é¡¹ç›®é…ç½®å› ä¸ºå¯¹prometheusçš„ä¸äº†è§£ï¼Œæˆ‘ç›´æ¥ä½¿ç”¨hyperfé»˜è®¤é…ç½®å¼•å…¥ç»„ä»¶composerrequirehyperf/metricå‘å¸ƒé»˜è®¤é…ç½®æ–‡ä»¶phpbin/hyperf.phpvendor:publishhyperf/metricåœ¨config/autoload/dependencies.phpä¸­æ·»åŠ å¯¹åº”çš„Rediså­˜å‚¨return[\\Prometheus\\Storage\\Adapter::class=&gt;\\Hyperf\\Metric\\Adapter\\Prometheus\\RedisStorageFactory::class,];åœ¨ä¸Šé¢çš„ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œè€å“¥è¯´ä½¿ç”¨swoole_tableæ›´é«˜æ•ˆï¼Œæˆ‘è¿˜ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨ï¼Œæœ‰å…´è¶£çš„è€å“¥å¯ä»¥è‡ªå·±ç ”ç©¶ä¸€ä¸‹ã€‚å¢åŠ ä¸­é—´ä»¶åœ¨config/autoload/middlewares.phpæ–‡ä»¶ä¸­å¢åŠ å¯¹åº”çš„ä¸­é—´ä»¶return['http'=&gt;[\\Hyperf\\Metric\\Middleware\\MetricMiddleware::class,],];æ·»åŠ metricsè·¯ç”±Router::get('/metrics',function(){$registry=Hyperf\\Utils\\ApplicationContext::getContainer()-&gt;get(Prometheus\\CollectorRegistry::class);$renderer=newPrometheus\\RenderTextFormat();return$renderer-&gt;render($registry-&gt;getMetricFamilySamples());});è¿™æ ·å¯¹é¡¹ç›®çš„é…ç½®å°±å®Œæˆäº†ä¸‰.prometheusçš„é…ç½®åœ¨prometheus.ymlæ–‡ä»¶ä¸­å¢åŠ å¯¹åº”çš„é…ç½®scrape_configs:#Thejobnameisaddedasalabel`job=&lt;job_name&gt;`toanytimeseriesscrapedfromthisconfig.-job_name:'prometheus'#metrics_pathdefaultsto'/metrics'#schemedefaultsto'http'.static_configs:-targets:['localhost:9090']-job_name:'node'#æ³¨æ„è¿™é‡Œçš„IPéœ€è¦å¡«å†™node-exporterå®¹å™¨çš„ipstatic_configs:-targets:['172.18.0.2:9100']-job_name:'skeleton'#è¿™é‡Œå¡«å†™çš„æ˜¯å®¿ä¸»æœºçš„ipstatic_configs:-targets:['10.0.75.1:9502']é…ç½®å®Œæˆä¹‹åï¼Œå†æ¬¡dokcer-composeupè®¿é—®http://localhost:9090æŸ¥çœ‹prometheuså¦‚å›¾æ‰€ç¤ºï¼Œnodeå’Œskeletonéƒ½å·²å¯åŠ¨å››.Grafanaé…ç½®ä¸Šé¢éƒ½é…ç½®å®Œäº†ï¼Œå¼€å§‹é…ç½®Grafanaæ‰“å¼€http://localhost:3000é»˜è®¤å¯†ç æ˜¯:admin/adminæ–°å»ºdatasourceå·¦ä¾§è¾¹æ adddatasourcesé€‰æ‹©Prometheusé…ç½®datasourceå¡«å†™å®¹å™¨çš„IP:ç«¯å£å¯¼å…¥hyperfå®˜æ–¹çš„JSONæ–‡ä»¶å¯¼å…¥ä¹‹åéœ€è¦å°†é»˜è®¤çš„app_nameæ”¹æˆä½ è‡ªå·±çš„å¦‚ï¼šadmin-apiå°±éœ€è¦å¡«å†™admin_apiæ”¹æˆä¸‹åˆ’çº¿å½¢å¼æŸ¥çœ‹ç›‘æ§åœ¨Homeä¸­ä½ å°±å¯ä»¥çœ‹åˆ°äº†ç‚¹è¿›å»æŸ¥çœ‹åˆ°æ­¤ç»“æŸï¼Œå°ç™½ç¬¬ä¸€æ¬¡é…ç½®ç›‘æ§ï¼Œè¿˜æœ‰å¾ˆå¤šä¸œè¥¿æ²¡å¼„æ¸…æ¥š","link":"https://marunrun.github.io/post/hyperf-grafana/"}]}